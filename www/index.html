<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8" />
       <!-- <meta name="format-detection" content="telephone=no" /> -->

        <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="msapplication-tap-highlight" content="no">

        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <script src="js/jquery-2.1.4.min.js"></script>
        <script src="js/chui-3.8.10.min.js"></script>
        <script src="js/jqrcode.min.js"></script>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="css/menu.css">

        <title>BarrioOS</title>

        <script id="dashboardTemplate" type="text/x-template">
            <section class="tarjeta">
                <div class="row">
                    <div class="col-xs-12 text-left">
                        <h3 class="text-left">Vecino de</h3>
                        <h2 class="localidad">[[= data.barrio ]]</h2>
                    </div>
                </div>
                <div class="row qr">
                    <div class="col-xs-5">
                        <img src="[[= data.avatar_standar  ]]" alt="[[= data.first_name  ]]" class="img-circle"  style="margin-top:2vh;">
                    </div>
                    <div class="col-xs-7">
                        <h2>[[= data.first_name  ]]</h2>
                        <h1><i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i></h1>
                        <h4>[[= data.rating  ]]</h4>
                    </div>
                </div>
                <div style="display: none" id="containerCodeBidi" class="col-xs-12 text-center">
                </div>
            </section>
        </script>
        <script id="profileTemplate" type="text/x-template">
            <section class="perfil">
                <div class="row">
                    <div class="col-xs-12">
                        <p id="popupUpdate" class="attentionGrapper"></p>
                        <form id="formUpdate" action="users/me" method="PUT" class="form-horizontal">
                            <div class="form-group">
                                <label for="first_name" class="col-xs-4 control-label">Nombre</label>
                                <div class="col-xs-8">
                                    <input id="firstNameUpdate" name="first_name" value="[[= data.first_name ]]" type="text" autocapitalize="words" class="form-control" autocorrect="off" required>
                                    <span data-error="first_name"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="last_name" class="col-xs-4 control-label">Apellidos</label>
                                <div class="col-xs-8">
                                    <input id="lastNameUpdate" name="last_name" value="[[= data.last_name ]]" type="text" autocapitalize="words" class="form-control" autocorrect="off" >
                                    <span data-error="last_name"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email" class="col-xs-4 control-label">Correo</label>
                                <div class="col-xs-8">
                                  <input id="emailUpdate" name="email" type="email" value="[[= data.email ]]" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com"  autocapitalize="off" autocorrect="off" class="form-control" required>
                                  <span data-error="email"></span>
                                </div>

                            </div>
                            <div class="form-group">
                                <label for="email_confirmation" class="col-xs-4 control-label">Repita Correo</label>
                                <div class="col-xs-8">
                                  <input id="emailUpdateRe" name="email_confirmation" type="email" value="[[= data.email ]]" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" autocapitalize="off" autocorrect="off" class="form-control" required>
                                  <span data-error="email_confirmation"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="postal_code" class="col-xs-4 control-label" id="r-con">Código Postal</label>
                                <div class="col-xs-8">
                                    <input id="postalCodeUpdate" name="postal_code" type="text" value="[[= data.postal_code ]]" pattern="^\d+$" title="Solo números" autocapitalize="off" autocorrect="off" class="form-control" maxlength="5" required>
                                    <span data-error="postal_code"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="phone" class="col-xs-4 control-label">Teléfono</label>
                                <div class="col-xs-8">
                                    <input id="phoneUpdate" name="phone" type="text" value="[[= data.phone ]]" maxlength="20" autocapitalize="off" class="form-control" autocorrect="off">
                                    <span data-error="phone"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="address" class="col-xs-4 control-label">Dirección</label>
                                <div class="col-xs-8">
                                    <textarea id="addressUpdate" name="address" type="text" maxlength="200" class="form-control" autocorrect="off">[[= data.address ]]</textarea>
                                    <span data-error="address"></span>
                                </div>
                            </div>
                                <div class="col-xs-offset-4 col-xs-8">
                                    <a id="goToAvatar" class="btn btn-default btn-block" id="cambiaravatar">Cambiar Avatar</a>
                                </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-xs-12 text-center">
                                      <button id="executeUpdate" class="btn btn-primary btn-lg btn-block">Guardar Cambios</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </script>
        <script id="avatarTemplate" type="text/x-template">
            <section class="qr-sec">
                <div class="row">
                    <div id="avatarContainer" class="col-xs-12 text-center">
                            <img src="[[= data.avatar_standar  ]]" alt="Persona" class="img-circle margin">
                    </div>
                    <div class="col-xs-12 text-center">
                            <a id="avatarButton" class="btn btn-primary btn-lg">Seleccionar Avatar</a>
                    </div>
                </div>
            </section>
            <!--<section>
                <div class="grid center gutter-5">
                    <div id="avatarContainer" class="col flex-10">
                        <img src='[[= data.avatar_standar  ]]' height="150" />
                    </div>
                </div>
                <div class="grid center gutter-5">
                    <div class="col flex-10">
                            <div class='horizontal centered'>
                                <button id="avatarButton"> Seleccionar Avatar </button>
                            </div>

                    </div>
                </div>
            </section> -->
        </script>
        <script id="qrCodeTemplate" type="text/x-template">
            <section class="qr-sec">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="embajador text-center">
                            <img src="[[= data.code  ]]" alt="QR">
                            <h2>[[= data.number  ]]</h2>
                        </div>
                    </div>
                </div>
            </section>
        </script>
        <script>
            $(function() {

                setTimeout(function() {
                        $("body").fadeIn();
                    });

                //if($.isAndroid || $.isChrome){
                    $("head").append("<link rel='stylesheet' type='text/css' href='css/themeAndroid.css' />");
                    setTimeout(function() {
                        $("body").fadeIn();
                    });
                /*}
                else{
                    $("head").append("<link rel='stylesheet' type='text/css' href='css/themeIos.css' />");
                    setTimeout(function() {
                        $("body").fadeIn();
                    });
                }*/

                var user = JSON.parse(window.localStorage.getItem('user'));
                var myDashboardTmpl = $.template($("#dashboardTemplate").text());
                var myProfileTmpl = $.template($("#profileTemplate").text());
                var myAvatarTmpl = $.template($("#avatarTemplate").text());
                var myQrCodeTmpl = $.template($("#qrCodeTemplate").text());

                goToDashboard = function(){

                    $.UIGoToArticle('#dashboard');

                    if($("#dashboard").text().trim()!="")
                        return;

                    var user = JSON.parse(window.localStorage.getItem('user'));
                    var codeBidi = window.localStorage.getItem('codeBidi');
                    $('#dashboard').html(myDashboardTmpl(user));
                    if(codeBidi){
                        $("#containerCodeBidi").html('<img src="'+ codeBidi +'" class="qr-img" />');
                        $("#containerCodeBidi").fadeIn();
                    }
                    else
                    {
                        setTimeout(function(){
                            var qrcode = new QRCode("containerCodeBidi", {
                                text: "http://www.proyectodes.net/users/"+user.id,
                                width: 270,
                                height: 270,
                                colorDark : "#000000",
                                colorLight : "#ffffff",
                                correctLevel : QRCode.CorrectLevel.H
                            });


                            setTimeout(function(){
                                window.localStorage.setItem('codeBidi',$('#containerCodeBidi img').attr('src'));
                                $("#containerCodeBidi").html('<img src="'+ $('#containerCodeBidi img').attr('src') +'" class="qr-img" />');
                                $("#containerCodeBidi").fadeIn();
                            },500)
                        }, 500);
                    }

                    $("#containerCodeBidi").on("singletap", function() {

                        $.UIGoToArticle("#qrCode");
                        if($("#qrCode").text().trim()!="")
                            return;

                        var data = {};

                        if(user.bidicode) data.number = user.bidicode.toString();
                        data.code = $('#containerCodeBidi img').attr('src')

                        $('#qrCode').html(myQrCodeTmpl(data));

                    });
                }

                var goToProfile = function(){
                    $.UIGoToArticle('#profile');

                    user = JSON.parse(window.localStorage.getItem('user'));

                    if($("#profile").text().trim()!="")
                        return;

                    $('#profile').html(myProfileTmpl(user));

                    $("#goToAvatar").on("singletap", function(){
                        goToAvatar('profile');
                    });

                    $("#executeUpdate").on("singletap", function(){
                        $("#formUpdate").submit();
                    });

                    $("#formUpdate").on("submit", function (e) {

                        e.preventDefault();

                        if(!validateConfirmation("formUpdate","emailUpdate", "email", "Correos" )){
                            return false;
                        }

                        doAjax({
                            identifier:"formUpdate",
                            beforeSend: function(){
                                cleanFormErrors("formUpdate");
                                $.UIPopup({empty: true});
                                $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                $('.popup').find('.busy').UICenter('relative');

                            },
                            success:function(response){

                                $('.popup').UIPopupClose();

                                showPopup('Exito al actualizar tu información' ,
                                        'Haz actualizado tu información correctamente',
                                        'Hecho',
                                        '',
                                        'popupUpdate');

                                window.localStorage.setItem("user", JSON.stringify(response));
                            },
                            error:function(response){
                                $('.popup').UIPopupClose();

                                if(response.responseJSON.status_code == 422)
                                {
                                    var errors = response.responseJSON.errors;
                                    var $form = $("#formUpdate");
                                    $.each(errors, function(key, value) {
                                        var sel = $form.find("span[data-error='"+ key +"']");
                                        $(sel).html(value);
                                        $(sel).parent().addClass('hasError');
                                    });
                                }
                                else
                                {
                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta solicitando dentro de un momento',
                                            'Hecho',
                                            '',
                                            'popupUpdate');
                                }
                            }
                        })
                    });
                }
                GLOBAL_VAR_AVATAR_DONE = 1;
                var goToAvatar = function(navigation){

                    $.UIGoToArticle('#avatar');

                    if(navigation == 'profile') {
                        $('#avatarBack').show();
                    }
                    else{
                        $('#avatarBack').hide();
                    }
                    navigationAvatar = navigation;
                    if($("#avatar").text().trim()!="")
                        return;

                    var user = JSON.parse(window.localStorage.getItem('user'));
                    $('#avatar').html(myAvatarTmpl(user));

                    $("#avatarButton").on("singletap", function(){
                        getImage();
                    });

                    $('#avatarDone').on('singletap', function (){
                        if(GLOBAL_VAR_AVATAR_DONE == 0)
                            return;
                        GLOBAL_VAR_AVATAR_DONE = 0;

                        if(typeof IMAGE_DATA == "undefined"){
                            if(navigationAvatar == 'profile') {

                                $.UIGoBackToArticle('#profile');
                                GLOBAL_VAR_AVATAR_DONE = 1;

                            }
                            else
                            {
                                goToDashboard();
                                GLOBAL_VAR_AVATAR_DONE = 1;
                            }
                        }
                        else{

                            $.ajaxSetup({
                                headers: { 'Authorization': 'Bearer ' + user.token }
                            });

                            $.ajax({
                                url: "http://www.proyectodes.net/api/users/me/avatar",
                                type: "POST",
                                data: { avatar: IMAGE_DATA.toString() },
                                beforeSend:function(){
                                    $.UIPopup({empty: true});
                                    $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                    $('.popup').find('.busy').UICenter('relative');
                                },
                                success:function(response){
                                    GLOBAL_VAR_AVATAR_DONE = 1;
                                    $('#dashboardImg').html("<img src='" + IMAGE_DATA + "' height='150' width='150' />")


                                    IMAGE_DATA = undefined;

                                    window.localStorage.setItem("user", JSON.stringify(response));

                                    if(navigationAvatar == 'profile') {
                                        setTimeout(function() {
                                            $.UIGoBackToArticle('#profile');
                                        }, 300);

                                    }
                                    else
                                    {
                                        setTimeout(function() {
                                            goToDashboard();
                                        }, 300);

                                    }
                                    $('.popup').UIPopupClose();
                                },
                                error: function (response) {
                                    GLOBAL_VAR_AVATAR_DONE = 1;

                                    $('.popup').UIPopupClose();
                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta subir el avatar nuevamente',
                                            'Hecho',
                                            '',
                                            'popupRegister');

                                }
                            });
                        }
                    });
                };

                var doAjax = function(options){
                    var user = JSON.parse(window.localStorage.getItem('user'));

                    var url = "http://www.proyectodes.net/api/";

                    if(user){
                        $.ajaxSetup({
                            headers: { 'Authorization': 'Bearer ' + user.token }
                        });
                    }
                    $.ajax({
                        url: url + $('#'+ options.identifier).attr("action"),
                        type: $('#'+ options.identifier).attr("method"),
                        data: $('#'+ options.identifier).serialize(),
                        beforeSend: options.beforeSend,
                        success: options.success,
                        error: options.error
                    });
                }

                var validateConfirmation = function(form, identifier, keyDataError, Message){

                    if($("#"+identifier).val() != $("#"+identifier+"Re").val()){
                        $("#"+ form +" span[data-error='"+keyDataError+"']").html(Message+" no coiciden");
                        $("#"+ form +" span[data-error='"+keyDataError+"']").parent().addClass("hasError");
                        $("#"+ form +" span[data-error='"+keyDataError+"_confirmation']").html(Message+" no coiciden");
                        $("#"+ form +" span[data-error='"+keyDataError+"_confirmation']").parent().addClass("hasError");
                        return false;
                    }
                    return true;
                }

                var cleanFormErrors = function(form){
                    $("#"+form+" li div").removeClass('hasError');
                    $("#"+form+" li div span[data-error]").html("");
                    $("#"+form+" h3[data-error]").html("");
                }

                showPopup = function(title , message, cancelTitle, continueTitle, popupIdCallback ){
                    $.UIPopup({
                        id: "warning",
                        title: title,
                        message: message,
                        cancelButton: cancelTitle,
                        continueButton: continueTitle,
                        callback: function() {
                            var popup = document.querySelector('#'+popupIdCallback);
                            popup.textContent = 'Thanks for staying with us a bit longer.';
                            popup.classList.remove("animatePopupMessage");
                            popup.classList.add("animatePopupMessage");
                        }
                    });
                }

                if(user){
                    goToDashboard();
                }

                $("#formLogin").on("submit", function (e) {
                    e.preventDefault();
                    doAjax({
                        identifier:"formLogin",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            //Clean errors
                            cleanFormErrors("formLogin");

                        },
                        success:function(response){

                            $('.popup').UIPopupClose();

                            $("#formLogin")[0].reset();
                            window.localStorage.setItem("user", JSON.stringify(response));

                            goToDashboard();
                        },
                        error:function(response){
                            $('.popup').UIPopupClose();
                            if(response.responseJSON.status_code == 403){
                                var sel = $("#formLogin").find("h3[data-error='validation']");
                                $(sel).html("Su correo o contraseña son invalidos");
                            }
                            else
                            {
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta iniciar sesion nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRegister');
                            }
                        }
                    })
                });

                $("#formRegister").on("submit", function (e) {
                    e.preventDefault();

                    if(!validateConfirmation("formRegister","emailSignup", "email", "Correos" )){
                        return false;
                    }

                    if(!validateConfirmation("formRegister","passwordSignup", "password", "Contraseñas" )){
                        return false;
                    }

                    doAjax({
                        identifier:"formRegister",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            cleanFormErrors("formRegister");

                        },
                        success:function(response){
                            $("#formRegister")[0].reset();
                            $('.popup').UIPopupClose();
                            window.localStorage.setItem("user", JSON.stringify(response));
                            goToAvatar();

                        },
                        error:function(response){

                            $('.popup').UIPopupClose();

                            if(response.responseJSON.status_code == 422){
                                var errors = response.responseJSON.errors;
                                var $form = $("#formRegister");
                                $.each(errors, function(key, value) {
                                    var sel = $form.find("span[data-error='"+ key +"']");
                                    $(sel).html(value);
                                    $(sel).parent().addClass('hasError');
                                });
                            }
                            else
                            {
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta registrarte nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRegister');
                            }

                        }
                    })
                });

                $("#formRecover").on("submit", function (e) {
                    e.preventDefault();
                    doAjax({
                        identifier:"formRecover",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            cleanFormErrors("formRecover");

                        },
                        success:function(response){

                            $('.popup').UIPopupClose();

                            $('#formRecover')[0].reset();

                            showPopup('Exito al enviar la solicitud' ,
                                    'Un correo de recuperación ha sido enviado a tu email',
                                    'Hecho',
                                    '',
                                    'popupRecover');
                        },
                        error:function(response){

                            $('.popup').UIPopupClose();

                            if(response.responseJSON.status_code == 404){
                                var $form = $("#formRecover");
                                var sel = $form.find("span[data-error='email']");
                                $(sel).html("Este correo no se encuentra");
                                $(sel).parent().addClass('hasError');

                            }else{
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta solicitando tu contraseña nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRecover');
                            }
                        }
                    })
                });

                var toggle_sidebar = function() {
                    var sidebar = document.getElementById("sidebar");
                    if(sidebar.style.left == "-200px"){
                        sidebar.style.left = "0px";
                        sidebar.style.display = "block";
                    }
                    else
                    {
                        sidebar.style.left = "-200px";
                    }
                }

                // This is just an animation for popup callback,
                // Not part of popup functionality.
                $("#popupMessageTarget").on("webkitAnimationEnd", function() {
                    this.className = "";
                    this.textContent = "";
                });

                $("#loginFacebook").on("singletap", function(){
                    login();
                });

                $("#goTologin").on("singletap", function () {
                    $.UIGoToArticle("#login");
                });

                $("#goToForgotPassword").on("singletap", function () {
                    $.UIGoToArticle("#forgotPassword");
                });

                $("#goToSignup").on("singletap", function () {
                    $.UIGoToArticle("#signup");
                });

                $("#goToDashboard").on("singletap", function () {
                    $.UIGoToArticle("#dashboard");
                });

                $("#goToProfile").on("singletap", function () {
                    goToProfile();
                });

                $("#signOut").on("singletap", function(){

                    window.localStorage.removeItem("user");
                    window.localStorage.removeItem("codeBidi");

                    $("#dashboard").children().remove();
                    $("#avatar").children().remove();
                    $("#profile").children().remove();
                    $("#avatarDone").unbind();
                    sidebar = document.getElementById("sidebar");
                    sidebar.style.left = "-200px";

                    $.UIPopup({empty: true});
                    $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                    $('.popup').find('.busy').UICenter('relative');

                    setTimeout(function(){
                        $('.popup').UIPopupClose();
                        sidebar.style.display = "none";
                        $.UIGoBackToArticle("#main");
                    },1000);
                });

               $("body").on("singletap",function(e){

                    var container = $("#menu");

                    if (!container.is(e.target)
                        && container.has(e.target).length === 0)
                    {
                        sidebar = document.getElementById("sidebar");
                        if(sidebar.style.left != "-200px"){
                            sidebar.style.left = "-200px";
                        }
                    }else{
                        toggle_sidebar();
                    }
                });


            });
        </script>
        <style type="text/css">
            section{
                background: transparent !important;
            }
            #global-nav{
                background-color: #1974c1 !important;
            }
            .hasError{
                color:darkred !important;
            }
        </style>

    </head>
    <body  id="index" style="display: none">

        <!--
        /
        /  MAIN PAGE
        /
        -->
        <article id="main">
            <section class="index">
                <div class="text-center">
                    <img src="images/barrioos-vertical.png" alt="BarrioOS" width="150px" height="auto">
                    <h3>Conecta con tu Barrio</h3>
                </div>
                <div class="index-fb">
                    <div class="col-xs-12 text-center">
                        <div class="row fb">
                            <a id="loginFacebook" >
                                    <i class="fa fa-facebook"></i>
                                    <p>Registrate con Facebook <br>
                                    <small>No publicaremos nada en tu muro</small></p>
                            </a>
                        </div>
                      <a id="goTologin" class="btn btn-default btn-lg pull-left" >Ingresar</a>
                      <a id="goToSignup" class="btn btn-default btn-lg pull-right">Registrar</a>
                    </div>
                </div>
            </section>
        </article>
        <!--
        /
        /  Login
        /
        -->
        <nav class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
              <a class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i style="color: #1974C1" class="fa fa-arrow-left"></i>
            </a>
              <h1 class="text-left title">Ingresar</h1>
              <a class="navbar-brand b-barrioos" ><img src="images/barrioos-iso.png" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="login" class="next">
            <section class="ingresar">
                <div class="row">
                    <div class="col-xs-10 col-xs-offset-1">
                        <form id="formLogin" action="auth/login" method="POST" class="form-horizontal" >
                          <h3 data-error="validation" class="hasError"></h3>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="emailLogin" name="email" type="email" autocapitalize="off" autocorrect="off" placeholder="Correo" class="form-control" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                                <input id="passwordLogin" name="password" type="password" maxlength="16" autocapitalize="off" autocorrect="off" placeholder="Contraseña" class="form-control" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12 text-center submitregistro">
                                <button style="margin:0px" type="submit" class="btn btn-default btn-lg btn-block" >Ingresar</button>
                            </div>
                          </div>
                          <div style="padding-top:20px" class="form-group">
                            <div class="col-xs-12 text-center">
                                <a id="goToForgotPassword" style="color:white;font-size:18px;">¿Haz olvidado tu contraseña?</a>
                            </div>
                          </div>
                        </form>
                    </div>
                </div>
            </section>
        </article>
        <!--
        /
        /  Register
        /
        -->
        <nav class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
              <a class="navbar-toggle menu-left back" data-toggle="collapse" aria-expanded="false">
                <i style="color: #1974C1" class="fa fa-arrow-left"></i>
            </a>
              <h1 class="text-left title" >Registro</h1>
              <a class="navbar-brand b-barrioos"><img src="images/barrioos-iso.png" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="signup" class="next">
            <section class="registro">
                <p id="popupRegister" class="attentionGrapper"></p>
                <div class="row">
                    <div class="col-xs-10 col-xs-offset-1">
                        <form id="formRegister" action="auth/register" method="POST" class="form-horizontal">
                            <div class="form-group">
                              <div class="col-xs-12">
                                <input id="nameSignup" name="first_name" type="text" autocapitalize="words" autocorrect="off" placeholder="Nombre de Pila" class="form-control" required>
                                <span data-error="first_name"></span>
                              </div>
                            </div>
                            <div class="form-group">
                              <div class="col-xs-12">
                                <input id="emailSignup" name="email" type="email" autocapitalize="off" autocorrect="off" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" class="form-control" placeholder="Correo" required>
                                <span data-error="email"></span>
                              </div>
                            </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="emailSignupRe" name="email_confirmation" type="email" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Repetir Correo" required>
                              <span data-error="email_confirmation"></span>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="passwordSignup" name="password" type="password" maxlength="16" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Contraseña" required>
                              <span data-error="password"></span>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="passwordSignupRe" name="password_confirmation" maxlength="16" type="password" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Repetir Contraseña" required>
                              <span data-error="password_confirmation"></span>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="postalCodeSignup" name="postal_code" type="text" maxlength="5" pattern="^\d+$" title="Solo números" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Código Postal" required>
                              <span data-error="postal_code"></span>
                            </div>
                          </div>

                          <div class="checkbox">
                            <label>
                              Al Registrarse, aceptas los <a href="">términos y condiciones</a> y la <a href="">política de privacidad</a>
                            </label>
                          </div>

                          <div class="form-group">
                            <div class="col-xs-12 text-center submitregistro">
                              <button type="submit" class="btn btn-default btn-lg btn-block">Registrar</button>
                            </div>
                          </div>
                        </form>
                    </div>
                </div>
            </section>
        </article>
        <!--
        /
        /  Select Avatar
        /
        -->
        <nav style="border-color: transparent" class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
                <a id="avatarBack" class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i     style="color: #1974C1;" class="fa fa-arrow-left"></i>
                </a>
              <h1 class="text-left title">Tu Imagen</h1>
              <button style="height: 37px;padding-top: 5px;" class="btn btn-default btn-lg pull-right" id="avatarDone">Hecho</button>
            </div>
        </nav>
        <article id="avatar" style="background-color:white !important; z-index:0">
        </article>
        <!--
        /
        /  Forgot Password
        /
        -->
        <nav class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
              <a class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i style="color: #1974C1" class="fa fa-arrow-left"></i>
            </a>
              <h1 style="font-size: 29px;" class="text-left title">Recuperar Contraseña</h1>
              <a class="navbar-brand b-barrioos" ><img src="images/barrioos-iso.png" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="forgotPassword" class="next">
            <section class="ingresar">
                <div class="row">
                    <div class="col-xs-10 col-xs-offset-1">
                        <form id="formRecover" action="auth/recover" method="POST" class="form-horizontal" >
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="emailRecover" name="email" type="email" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Email" required>
                              <span data-error="email"></span>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12 text-center submitregistro">
                                <button id="recoverExecute" style="margin:0px" type="submit" class="btn btn-default btn-lg btn-block" >Recuperar</button>
                            </div>
                          </div>
                        </form>
                    </div>
                </div>
            </section>
        </article>
        <!--
        /
        /  Index
        /
        -->
        <nav style="border-color: transparent" class="navbar navbar-default navbar-fixed-top">
            <div class="navbar-header">
                <button id="menu" type="button" class="navbar-toggle toggle-menu menu-left jPushMenuBtn" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
              <h1 class="text-left title">Tarjeta</h1>
              <a class="navbar-brand b-barrioos" ><img src="images/barrioos-iso.png" id="logo" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
            <div id="sidebar" style="top: 53px; position: fixed; display: inline-block; height: 1200px; width: 200px; left: -200px; background-color: #1974C1; transition: all 0.4s ease-in-out;">
                <ul style="width:215px" class="nav navbar-nav navbar-left">
                  <li><a>Grupo</a></li>
                  <li><a>Chat</a></li>
                  <li id="goToProfile" ><a>Perfil</a></li>
                  <li id="signOut" ><a>Cerrar Sesión</a></li>
              </ul>
            </div>
        </nav>
        <article id="dashboard" style="background-color:white !important; z-index:0">
        </article>
        <!--
        /
        /  QRCode
        /
        -->
        <nav style="border-color: transparent" class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
              <a class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i style="color: #1974C1" class="fa fa-arrow-left"></i>
            </a>
              <h1 class="text-left title">Tú Código</h1>
              <a class="navbar-brand b-barrioos" ><img src="images/barrioos-iso.png" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="qrCode" class="next" style="background-color:white !important; z-index:0" >
        </article>
        <!--
        /
        /  Profile
        /
        -->
        <nav style="border-color: transparent" class="navbar navbar-default navbar-fixed-top">
            <div class="navbar-header">
                <a class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i style="color: #1974C1;" class="fa fa-arrow-left"></i>
                </a>
              <h1 class="text-left title">Pérfil</h1>
              <a class="navbar-brand b-barrioos"><img src="images/barrioos-iso.png" id="logo" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="profile" style="background-color:white !important; z-index:0"></article>
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/facebookConnectPlugin.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
        <script type="text/javascript">

            function getImage() {

                try {

                    navigator.camera.getPicture(
                            function(imageData){
                                readMedia(imageData)
                            },
                            function(error){

                                if(error.toString() != "Selection cancelled."){
                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido ha salido mal, estamos corrigiendo todos los errores lo más pronto posible',
                                            'Hecho',
                                            '',
                                            'popupRegister');
                                }


                                return false;

                            },
                            {
                                quality: 80,
                                allowEdit : true,
                                destinationType: Camera.DestinationType.FILE_URI,
                                sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,
                                encodingType: Camera.EncodingType.JPEG,
                                targetWidth: 150,
                                targetHeight: 150,
                                mediaType:2
                            }
                    );
                }catch(err){
                    showPopup('Lo sentimos :(' ,
                            'Algo ha salido ha salido mal, estamos corrigiendo todos los errores lo más pronto posible',
                            'Hecho',
                            '',
                            'popupRegister');
                }
            }

            var login = function () {
                if (!window.cordova) {
                    //var appId = prompt("Enter FB Application ID", "");
                    facebookConnectPlugin.browserInit("1017010178318950");
                }
                facebookConnectPlugin.login( ["email","public_profile"],
                        function (response) {

                            //alert(JSON.stringify(response));
                            apiTest();

                        },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var showDialog = function () {
                facebookConnectPlugin.showDialog( { method: "feed" },
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var apiTest = function () {
                facebookConnectPlugin.api( "me/?fields=id,email,first_name,last_name", [],
                        function (response) {

                            var user = {}
                            user.provider_id = response.id;
                            user.email = response.email;
                            user.avatar_standar= "http://graph.facebook.com/"+response.id+"/picture?type=large";
                            user.avatar_thumbnail= "http://graph.facebook.com/"+response.id+"/picture?type=small";
                            user.first_name = response.first_name;
                            user.last_name = response.last_name;

                            $.ajax({
                                url: "http://www.proyectodes.net/api/auth/provider",
                                type: "POST",
                                data: user,
                                beforeSend: function(){
                                    $.UIPopup({empty: true});
                                    $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                    $('.popup').find('.busy').UICenter('relative');
                                },
                                success: function(response){
                                    $('.popup').UIPopupClose();
                                    window.localStorage.setItem("user", JSON.stringify(response));
                                    goToDashboard();
                                },
                                error: function(e){

                                    $('.popup').UIPopupClose();
                                    alert(JSON.stringify(e.responseJSON));

                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta iniciar nuevamente',
                                            'Hecho',
                                            '',
                                            'popupRegister');
                                }
                            });

                        },
                        function (response) {
                            showPopup('Lo sentimos :(' ,
                                    'Algo ha salido mal intenta iniciar nuevamente',
                                    'Hecho',
                                    '',
                                    'popupRegister');
                            alert(JSON.stringify(response))
                        });
            }

            var getAccessToken = function () {
                facebookConnectPlugin.getAccessToken(
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var getStatus = function () {
                facebookConnectPlugin.getLoginStatus(
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var logout = function () {
                facebookConnectPlugin.logout(
                        function (response) {
                            alert(JSON.stringify(response))
                        },
                        function (response) {
                            alert(JSON.stringify(response))
                        });
            }

            function readMedia(archivo){

                var imagenURL=archivo;

                window.resolveLocalFileSystemURL = window.resolveLocalFileSystemURL || window.webkitResolveLocalFileSystemURL;
                window.resolveLocalFileSystemURL(imagenURL, function(fileEntry) {
                    fileEntry.file(function(file){
                        var reader = new FileReader();
                        reader.onloadend = function(evt) {

                            IMAGE_DATA=evt.target.result;
                            $("#avatarContainer").html("<img src='" + IMAGE_DATA + "' class='img-circle margin' />");


                        };
                        reader.readAsDataURL(file);
                    }, function(e){

                    })
                });

                return false;
            }

        </script>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">

    </body>
</html>
