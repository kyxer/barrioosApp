<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8" />
       <!-- <meta name="format-detection" content="telephone=no" /> -->

        <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="msapplication-tap-highlight" content="no">

        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <script src="js/jquery-2.1.4.min.js"></script>
        <script src="js/chui-3.8.10.min.js"></script>
        <script src="js/jqrcode.min.js"></script>
        <script src="js/jquery.ui.widget.js"></script>
        <script src="js/jquery.iframe-transport.js"></script>
        <script src="js/jquery.fileupload.js"></script>

        <!--<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" /> -->
        <title>BarrioOS</title>
        <style type="text/css" media="all">
            /* Set background color for invalid inputs: */
            input:focus:invalid {
                background-color: rgba(225,0,0,0.05);
            }
            .horizontal.centered {
                margin-top: 20px;
                display: -webkit-box;
                display: -webkit-flex;
                display: flex;
                -webkit-box-orientation: horizontal;
                -webkit-flex-direction: row;
                -ms-flex-direction: row;
                flex-direction: row;
                -wekbit-box-pack: center;
                -wekbit-justify-content: center;
                -ms-justify-content: center;
                justify-content: center;
            }
            button {
                display: inline-block;
                margin: auto;
                width: auto;
            }
        </style>
        <style type="text/css" media="all">
            .col {
                padding: 20px 10px;
                /*border: solid 1px #ccc;
                background-color: #fff;*/
                color: #000;
                padding: 10px;
                text-align: center;
            }
            .col p {
                margin: 0;
            }
            .fixed1 {
                -webkit-box-flex: none;
                -webkit-flex: none;
                -ms-flex: none;
                flex: none;
                width: 400px;
                background-color: #eee !important;
            }
            .fixed2 {
                -webkit-box-flex: none;
                -webkit-flex: none;
                -ms-flex: none;
                flex: none;
                width: 300px;
                background-color: #eee !important;
            }

            @media all and (max-width: 599px) {
                .fixed1, .fixed2 {
                    width: auto;
                }
            }
            .isWindows .grid > .col > p {
                color: #000 !important;
            }
            .isWindows h2 {
                margin-top: 20px;
                margin-bottom: 20px;
            }

        /*For raiting*/
            .rating {

                unicode-bidi: bidi-override;
                direction: rtl;
            }
            .rating > span {
                font: 30px Georgia, serif;
                display: inline-block;
                position: relative;
                width: 1.1em;
                color:gold;
            }
            .rating > span:before {
                content: "\2605";
                position: absolute;
            }
            /* Popup Demo Styles */
            #popupMessageTarget {
                opacity: 0;
                font-size: 14pt;
                line-height: 16pt;
                font-weight: 200;
                font-family: SegoeWP, SegoeUI, HelveticaNeue, Roboto, Sans-serif;
                padding: 0 15px;
            }
            .animatePopupMessage {
                -webkit-animation-duration: 2s;
                -webkit-animation-timing-function: linear;
                -webkit-animation-name: updatePopupMessage;
                animation-duration: 2s;
                animation-timing-function: linear;
                animation-name: updatePopupMessage;
            }
            @-webkit-keyframes updatePopupMessage {
                0% { opacity: 0; }
                20% { opacity: 1; }
                90% { opacity: 1; }
                100% { opacity: 0; }
            }

            @keyframes updatePopupMessage {
                0% { opacity: 0; }
                20% { opacity: 1; }
                90% { opacity: 1; }
                100% { opacity: 0; }
            }

            .hasError{
                color:darkred !important;
            }

            .isAndroid .actionBtn{
                background: #276527 !important;
                color: whitesmoke !important;
            }

            .isAndroid .secondBtn{
                background: #3066a0 !important;
                color: whitesmoke !important;
            }

            .btn-facebook {
                color: #fff !important;
                background-color: #3b5998;
                border: 1px solid #335190;
            }

            .btn-facebook:hover,
            .btn-facebook:focus {
                color: #fff;
                background-color: #294786;
            }

            input[type="file"]{
                z-index: 999;
                line-height: 0;
                position: absolute;
                opacity: 0;
                filter: alpha(opacity = 0);-ms-filter: "alpha(opacity=0)";
                margin: 0;
                padding:0;
                cursor: pointer;
            }

        </style>
        <script id="dashboardTemplate" type="text/x-template">
            <section>
                <div class="grid gutter-5">
                    <div class="col flex-3">
                        <p>Vecino de</p>
                        <p>[[= data.barrio ]]</p>
                    </div>
                    <div class="col flex-3">
                        <p>BarrioOS</p>
                    </div>
                </div>
                <div class="grid gutter-5">
                    <p id="popupMessageTarget" class="attentionGrapper"></p>
                    <div id="dashboardImg" class="col flex-3">
                        <img title="[[= data.first_name  ]]" src="[[= data.avatar_standar  ]]" height="150px">
                    </div>
                    <div class="col flex-3">
                        <div class="rating">
                            <p>[[= data.first_name ]]</p>
                            <span>☆</span><span>☆</span><span>☆</span><span>☆</span><span>☆</span>
                            </div>
                        <br>
                        <div style="display: none" id="containerCodeBidi"></div>
                    </div>
                </div>
            </section>
        </script>
        <script id="profileTemplate" type="text/x-template">
            <section>
                <p id="popupUpdate" class="attentionGrapper"></p>
                <h2>Edita tu información</h2>
                <form id="formUpdate" action="users/me" method="PUT" >
                    <ul class='list' ui-implements='form'>
                        <li class="comp">
                            <div>
                                <label for="firstNameUpdate">Nombre:</label>
                                <span data-error="first_name"></span>
                            </div>
                            <aside>
                                <input id="firstNameUpdate" name="first_name" value="[[= data.first_name ]]" type="text" autocapitalize="words" autocorrect="off" required>
                            </aside>
                        </li>
                        <li class="comp">
                            <div>
                                <label for="lastNameUpdate">Apellido:</label>
                                <span data-error="last_name"></span>
                            </div>
                            <aside>
                                <input id="lastNameUpdate" name="last_name" value="[[= data.last_name ]]" type="text" autocapitalize="words" autocorrect="off" >
                            </aside>
                        </li>
                        <li class="comp">
                            <div>
                                <label for="emailUpdate">Correo:</label>
                                <span data-error="email"></span>
                            </div>
                            <aside>
                                <input id="emailUpdate" name="email" type="email" value="[[= data.email ]]" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com"  autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                        <li class="comp">
                            <div>
                                <label for="emailUpdateRe">Repita Correo:</label>
                                <span data-error="email_confirmation"></span>
                            </div>
                            <aside>
                                <input id="emailUpdateRe" name="email_confirmation" type="email" value="[[= data.email ]]" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                        <!--<li class='comp'>
                            <div>
                                <label for='passwordUpdate'>Contraseña:</label>
                                <span data-error="password"></span>
                            </div>
                            <aside>
                                <input id="passwordUpdate" name="password" type="password" value="" maxlength="16" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                        <li class='comp'>
                            <div>
                                <label for='passwordReUpdate'>Repita Contraseña:</label>
                                <span data-error="password_confirmation"></span>
                            </div>
                            <aside>
                                <input id="passwordReUpdate" name="password_confirmation" type="password"
                                       value="" maxlength="16" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li> -->
                        <li class='comp'>
                            <div>
                                <label for='postalCodeUpdate'>Código Postal:</label>
                                <span data-error="postal_code"></span>
                            </div>
                            <aside>
                                <input id="postalCodeUpdate" name="postal_code" type="text" value="[[= data.postal_code ]]" pattern="^\d+$" title="Solo números" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                    </ul>
                    <br>
                    <ul class='list' ui-implements='form'>
                        <li class='comp'>
                            <div>
                                <label for='phoneUpdate'>Telefono:</label>
                                <span data-error="phone"></span>
                            </div>
                            <aside>
                                <input id="phoneUpdate" name="phone" type="text" value="[[= data.phone ]]" maxlength="20" autocapitalize="off" autocorrect="off">
                            </aside>
                        </li>
                        <li class='comp'>
                            <div>
                                <label for='addressUpdate'>Direccion:</label>
                                <span data-error="address"></span>
                            </div>
                            <aside>
                                <input id="addressUpdate" name="address" type="text" maxlength="200" value="[[= data.address ]]" autocapitalize="off" autocorrect="off">
                            </aside>
                        </li>
                    </ul>
                    <br>
                    <ul class='list'>
                        <li class='nav' id="goToAvatar">
                            <h3>Cambiar Avatar</h3>
                        </li>
                    </ul>
                </form>
            </section>
        </script>
        <script id="avatarTemplate" type="text/x-template">
            <section>
                <div class="grid center gutter-5">
                    <div id="avatarContainer" class="col flex-10">
                        <img src='[[= data.avatar_standar  ]]' height="150" />
                    </div>
                </div>
                <div class="grid center gutter-5">
                    <div class="col flex-10">
                            <div class='horizontal centered'>
                                <button id="avatarButton"> Seleccionar Avatar </button>
                            </div>

                    </div>
                </div>
            </section>
        </script>
        <script>
            $(function() {

                if(($.isAndroid || $.isChrome)){
                    $("head").append("<link rel='stylesheet' type='text/css' href='css/themeAndroid.css' />");
                    setTimeout(function() {
                        $("body").fadeIn();
                    });
                }
                else{
                    $("head").append("<link rel='stylesheet' type='text/css' href='css/themeIos.css' />");
                    setTimeout(function() {
                        $("body").fadeIn();
                    });
                }

                var user = JSON.parse(window.localStorage.getItem('user'));
                console.log(user);
                var optionsContent = "<ul class='list'><li id='gotToProfile' ><h3>Perfil</h3></li><li id='signOut'><h3>Cerrar Sesion</h3></li></ul>";
                var myDashboardTmpl = $.template($("#dashboardTemplate").text());
                var myProfileTmpl = $.template($("#profileTemplate").text());
                var myAvatarTmpl = $.template($("#avatarTemplate").text());

                goToDashboard = function(){

                    $.UIGoToArticle('#dashboard');

                    if($("#dashboard").text().trim()!="")
                        return;

                    var user = JSON.parse(window.localStorage.getItem('user'));
                    var codeBidi = window.localStorage.getItem('codeBidi');
                    //$('#dashboard').empty();
                    $('#dashboard').html(myDashboardTmpl(user));

                    if(codeBidi){
                        $("#containerCodeBidi").html('<img src="'+ codeBidi +'" height="80px" />');
                        $("#containerCodeBidi").fadeIn();
                    }
                    else
                    {
                        setTimeout(function(){
                            var qrcode = new QRCode("containerCodeBidi", {
                                text: "http://www.proyectodes.net/users/"+user.id,
                                width: 270,
                                height: 270,
                                colorDark : "#000000",
                                colorLight : "#ffffff",
                                correctLevel : QRCode.CorrectLevel.H
                            });
                            $('#containerCodeBidi img').attr({
                                height:'80px'
                            });

                            setTimeout(function(){
                                window.localStorage.setItem('codeBidi',$('#containerCodeBidi img').attr('src'));
                                $("#containerCodeBidi").html('<img src="'+ $('#containerCodeBidi img').attr('src') +'" height="80px" />');
                                $("#containerCodeBidi").fadeIn();
                            },500)

                        }, 500);
                    }

                    $("#containerCodeBidi").on("singletap", function() {

                        var src = $('#containerCodeBidi img').attr('src');

                        showPopup( user.bidicode.toString() ,
                                '<img  src="'+src+'" height="270px">',
                                'Salir',
                                '',
                                'popupMessageTarget');
                    });
                }

                var goToProfile = function(){
                    $.UIGoToArticle('#profile');

                    user = JSON.parse(window.localStorage.getItem('user'));

                    if($("#profile").text().trim()!="")
                        return;

                    $('#profile').html(myProfileTmpl(user));

                    $("#goToAvatar").on("singletap", function(){
                        goToAvatar('profile');
                    });

                    $("#formUpdate").on("submit", function (e) {

                        e.preventDefault();

                        if(!validateConfirmation("formUpdate","emailUpdate", "email", "Correos" )){
                            return false;
                        }

                        doAjax({
                            identifier:"formUpdate",
                            beforeSend: function(){
                                cleanFormErrors("formUpdate");
                                $.UIPopup({empty: true});
                                $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                $('.popup').find('.busy').UICenter('relative');

                            },
                            success:function(response){

                                $('.popup').UIPopupClose();

                                showPopup('Exito al actualizar tu información' ,
                                        'Haz actualizado tu información correctamente',
                                        'Hecho',
                                        '',
                                        'popupUpdate');

                                window.localStorage.setItem("user", JSON.stringify(response));
                            },
                            error:function(response){
                                $('.popup').UIPopupClose();

                                if(response.responseJSON.status_code == 422)
                                {
                                    var errors = response.responseJSON.errors;
                                    var $form = $("#formUpdate");
                                    $.each(errors, function(key, value) {
                                        var sel = $form.find("span[data-error='"+ key +"']");
                                        $(sel).html(value);
                                        $(sel).parent().addClass('hasError');
                                    });
                                }
                                else
                                {
                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta solicitando dentro de un momento',
                                            'Hecho',
                                            '',
                                            'popupUpdate');
                                }
                            }
                        })
                    });
                }

                var goToAvatar = function(navigation){

                    $.UIGoToArticle('#avatar');

                    if(navigation == 'profile') {
                        $('#avatarBack').show();
                    }
                    else{
                        $('#avatarBack').hide();
                    }
                    navigationAvatar = navigation;
                    if($("#avatar").text().trim()!="")
                        return;

                    var user = JSON.parse(window.localStorage.getItem('user'));
                    $('#avatar').html(myAvatarTmpl(user));

                    $("#avatarButton").on("singletap", function(){
                        getImage();
                    });

                    $('#avatarDone').on('singletap', function (){

                        if(typeof IMAGE_DATA == "undefined"){
                            if(navigationAvatar == 'profile') {
                                setTimeout(function() {
                                    $.UIGoBackToArticle('#profile');
                                }, 300);

                            }
                            else
                            {
                                setTimeout(function() {
                                    $.UIGoToArticle('#dashboard');
                                }, 300);

                            }
                        }
                        else{
                            $.ajaxSetup({
                                headers: { 'Authorization': 'Bearer ' + user.token }
                            });

                            $.ajax({
                                url: "http://www.proyectodes.net/api/users/me/avatar",
                                type: "POST",
                                data: { avatar: IMAGE_DATA.toString() },
                                beforeSend:function(){
                                    $.UIPopup({empty: true});
                                    $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                    $('.popup').find('.busy').UICenter('relative');
                                },
                                success:function(){

                                    $('#dashboardImg').html("<img src='" + IMAGE_DATA + "' height='150' width='150' />")
                                    $('.popup').UIPopupClose();

                                    IMAGE_DATA = undefined;

                                    window.localStorage.setItem("user", JSON.stringify(response));

                                    if(navigationAvatar == 'profile') {
                                        setTimeout(function() {
                                            $.UIGoBackToArticle('#profile');
                                        }, 300);

                                    }
                                    else
                                    {
                                        setTimeout(function() {
                                            $.UIGoToArticle('#dashboard');
                                        }, 300);

                                    }
                                },
                                error: function (response) {

                                    $('.popup').UIPopupClose();
                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta subir el avatar nuevamente',
                                            'Hecho',
                                            '',
                                            'popupRegister');

                                }
                            });
                        }


                    });
                };



                var doAjax = function(options){
                    var user = JSON.parse(window.localStorage.getItem('user'));

                    var url = "http://www.protectodes.com/api/";

                    if(user){
                        $.ajaxSetup({
                            headers: { 'Authorization': 'Bearer ' + user.token }
                        });
                    }
                    $.ajax({
                        url: url + $('#'+ options.identifier).attr("action"),
                        type: $('#'+ options.identifier).attr("method"),
                        data: $('#'+ options.identifier).serialize(),
                        beforeSend: options.beforeSend,
                        success: options.success,
                        error: options.error
                    });
                }

                var validateConfirmation = function(form, identifier, keyDataError, Message){

                    if($("#"+identifier).val() != $("#"+identifier+"Re").val()){
                        $("#"+ form +" span[data-error='"+keyDataError+"']").html(Message+" no coiciden");
                        $("#"+ form +" span[data-error='"+keyDataError+"']").parent().addClass("hasError");
                        $("#"+ form +" span[data-error='"+keyDataError+"_confirmation']").html(Message+" no coiciden");
                        $("#"+ form +" span[data-error='"+keyDataError+"_confirmation']").parent().addClass("hasError");
                        return false;
                    }
                    return true;
                }

                var cleanFormErrors = function(form){
                    $("#"+form+" li div").removeClass('hasError');
                    $("#"+form+" li div span[data-error]").html("");
                    $("#"+form+" h3[data-error]").html("");
                }

                showPopup = function(title , message, cancelTitle, continueTitle, popupIdCallback ){
                    $.UIPopup({
                        id: "warning",
                        title: title,
                        message: message,
                        cancelButton: cancelTitle,
                        continueButton: continueTitle,
                        callback: function() {
                            var popup = document.querySelector('#'+popupIdCallback);
                            popup.textContent = 'Thanks for staying with us a bit longer.';
                            popup.classList.remove("animatePopupMessage");
                            popup.classList.add("animatePopupMessage");
                        }
                    });
                }

                if(user){
                    goToDashboard();
                }

                $("#formLogin").on("submit", function (e) {
                    e.preventDefault();
                    doAjax({
                        identifier:"formLogin",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            //Clean errors
                            cleanFormErrors("formLogin");

                        },
                        success:function(response){

                            $('.popup').UIPopupClose();

                            $("#formLogin")[0].reset();
                            window.localStorage.setItem("user", JSON.stringify(response));

                            goToDashboard();
                        },
                        error:function(response){
                            $('.popup').UIPopupClose();
                            if(response.responseJSON.status_code == 403){
                                var sel = $("#formLogin").find("h3[data-error='validation']");
                                $(sel).html("Su correo o contraseña son invalidos");
                            }
                            else
                            {
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta iniciar sesion nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRegister');
                            }
                        }
                    })
                });

                $("#formRegister").on("submit", function (e) {
                    e.preventDefault();

                    if(!validateConfirmation("formRegister","emailSignup", "email", "Correos" )){
                        return false;
                    }

                    if(!validateConfirmation("formRegister","passwordSignup", "password", "Contraseñas" )){
                        return false;
                    }

                    doAjax({
                        identifier:"formRegister",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            cleanFormErrors("formRegister");

                        },
                        success:function(response){
                            $("#formRegister")[0].reset();
                            $('.popup').UIPopupClose();
                            window.localStorage.setItem("user", JSON.stringify(response));
                            goToAvatar();

                        },
                        error:function(response){

                            $('.popup').UIPopupClose();

                            if(response.responseJSON.status_code == 422){
                                var errors = response.responseJSON.errors;
                                var $form = $("#formRegister");
                                $.each(errors, function(key, value) {
                                    var sel = $form.find("span[data-error='"+ key +"']");
                                    $(sel).html(value);
                                    $(sel).parent().addClass('hasError');
                                });
                            }
                            else
                            {
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta registrarte nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRegister');
                            }

                        }
                    })
                });

                $("#formRecover").on("submit", function (e) {
                    e.preventDefault();
                    doAjax({
                        identifier:"formRecover",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            cleanFormErrors("formRecover");

                        },
                        success:function(response){

                            $('.popup').UIPopupClose();

                            $('#formRecover')[0].reset();

                            showPopup('Exito al enviar la solicitud' ,
                                    'Un correo de recuperación ha sido enviado a tu email',
                                    'Hecho',
                                    '',
                                    'popupRecover');
                        },
                        error:function(response){

                            $('.popup').UIPopupClose();

                            if(response.responseJSON.status_code == 404){
                                var $form = $("#formRecover");
                                var sel = $form.find("span[data-error='email']");
                                $(sel).html("Este correo no se encuentra");
                                $(sel).parent().addClass('hasError');

                            }else{
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta solicitando tu contraseña nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRecover');
                            }



                        }
                    })
                });

                // This is just an animation for popup callback,
                // Not part of popup functionality.
                $("#popupMessageTarget").on("webkitAnimationEnd", function() {
                    this.className = "";
                    this.textContent = "";
                });



                var popoverEventHandler = function() {

                    $("#gotToProfile").on("singletap", function () {
                        goToProfile();
                    });

                    $("#signOut").on("singletap", function(){
                        window.localStorage.removeItem("user");
                        window.localStorage.removeItem("codeBidi");
                        $("#dashboard").html('');
                        $("#avatar").html('');
                        $("#profile").html('');
                        $.UIGoBackToArticle("#main");
                    });

                    $('.popover').on('singletap', function(e) {
                        if ($.isAndroid || $.isChrome) {
                            setTimeout(function() {
                                $.UIPopoverClose();
                            }, 300);
                        } else {
                            $.UIPopoverClose();
                        }
                    });
                };

                $('#showOptions').on('singletap', function() {
                    var trigger = this;
                    $.UIPopover({
                        title: 'Opciones',
                        trigger: trigger,
                        content: optionsContent,
                        callback: function() {
                            popoverEventHandler();
                        }
                    });
                });

                $("#loginFacebook").on("singletap", function(){
                    login();
                });

                $("#goTologin").on("singletap", function () {
                    $.UIGoToArticle("#login");
                });

                $("#goToForgotPassword").on("singletap", function () {
                    $.UIGoToArticle("#forgotPassword");
                });

                $("#goToSignup").on("singletap", function () {
                    $.UIGoToArticle("#signup");
                });

                $("#goToDashboard").on("singletap", function () {
                    $.UIGoToArticle("#dashboard");
                });

                $("#executeUpdate").on("singletap", function(){
                    $("#formUpdate").submit();
                });


            });
        </script>
    </head>

    <body style="display: none">
        <nav>
            <h1>BarrioOS</h1>
        </nav>
        <article id="main">
        <section>
            <div class="grid center gutter-5">
                <div class="col flex-8">

                    <p>Bienvenidos a BarrioOS</p>

                    <div class='horizontal centered' >
                        <button id="goTologin" class="actionBtn">Iniciar Sesion</button>
                    </div>

                    <div class='horizontal centered'>
                        <button id="goToSignup" class="secondBtn">Registrarse</button>
                    </div>
                    <div class='horizontal centered'>
                        <button id="loginFacebook" class="btn-facebook">
                            <i class="ion-social-facebook"></i> Inicia con Facebook
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </article>
        <nav class="next">
            <button class="back">BarrioOS</button>
            <h1>Iniciar Sesión</h1>
            <button id="goToForgotPassword" >¿Contraseña?</button>
        </nav>
        <article id="login" class="next">
            <section>
                <h2>Inicia Sesión</h2>
                <form id="formLogin" action="auth/login" method="POST" >
                    <h3 data-error="validation" class="hasError"></h3>
                    <ul ui-implements='form' class='list'>
                        <li class='comp'>
                            <div>
                                <label for="emailLogin">Correo:</label>
                            </div>
                            <aside>
                                <input id="emailLogin" name="email" type="email" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                        <li class='comp'>
                            <div>
                                <label for='passwordLogin'>Contraseña:</label>
                            </div>
                            <aside>
                                <input id="passwordLogin" name="password" type="password" maxlength="16" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                    </ul>
                    <div class='horizontal centered'>
                        <button type="submit" class="actionBtn" >Iniciar Sesión</button>
                    </div>
                </form>
            </section>
        </article>
        <nav class="next">
            <button class="back">BarrioOS</button>
            <h1>Registrarse</h1>
        </nav>
        <article id="signup" class="next">
            <section>
                <p id="popupRegister" class="attentionGrapper"></p>
                <h2>Registrate</h2>
                <form id="formRegister" action="auth/register" method="POST">
                    <ul class='list' ui-implements='form'>
                    <li class="comp">
                        <div>
                            <label for="nameSignup">Nombre de Pila: </label>
                            <span data-error="first_name"></span>
                        </div>

                        <aside>
                            <input id="nameSignup" name="first_name" type="text" autocapitalize="words" autocorrect="off" required>
                        </aside>

                    </li>
                    <li class="comp">
                        <div>
                            <label for="emailSignup">Correo:</label>
                            <span data-error="email"></span>
                        </div>
                        <aside>
                            <input id="emailSignup" name="email" type="email" autocapitalize="off" autocorrect="off" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" required>
                        </aside>
                    </li>
                    <li class="comp">
                        <div>
                            <label for="emailSignupRe">Repita Correo:</label>
                            <span data-error="email_confirmation"></span>
                        </div>
                        <aside>
                            <input id="emailSignupRe" name="email_confirmation" type="email" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" autocapitalize="off" autocorrect="off" required>
                        </aside>
                    </li>
                    <li class='comp'>
                        <div>
                            <label for='passwordSignup'>Contraseña:</label>
                            <span data-error="password"></span>
                        </div>
                        <aside>
                            <input id="passwordSignup" name="password" type="password" maxlength="16" autocapitalize="off" autocorrect="off" required>
                        </aside>
                    </li>
                    <li class='comp'>
                        <div>
                            <label for='passwordSignupRe'>Repita Contraseña:</label>
                            <span data-error="password_confirmation"></span>
                        </div>
                        <aside>
                            <input id="passwordSignupRe" name="password_confirmation" maxlength="16" type="password" autocapitalize="off" autocorrect="off" required>
                        </aside>
                    </li>
                    <li class='comp'>
                        <div>
                            <label for='postalCodeSignup'>Código Postal:</label>
                            <span data-error="postal_code"></span>
                        </div>
                        <aside>
                            <input id="postalCodeSignup" name="postal_code" type="text" maxlength="5" pattern="^\d+$" title="Solo números" autocapitalize="off" autocorrect="off" required>
                        </aside>
                    </li>
                </ul>

                    <ul class='list' ui-implements='form'>
                    <li>
                        <p><small>Al hacer clic en Registrarse, aceptas los <a href="">términos y condiciones</a> y la <a href="">política de privacidad</a></small></p>
                    </li>
                </ul>
                    <button type="submit" class='action secondBtn'>Registrarse</button>
                </form>
            </section>
        </article>
        <nav>
            <button id="avatarBack" class="back"></button>
            <h1>Seleccionar Avatar</h1>
            <button id="avatarDone">Hecho</button>
        </nav>
        <article id="avatar">



        </article>
        <nav class="next">
            <button class="back">Iniciar</button>
            <h1>Recuperar Contraseña</h1>
        </nav>
        <article id="forgotPassword" class="next">
            <section>
                <p id="popupRecover" class="attentionGrapper"></p>
                <h2>Solicita tu contraseña</h2>
                <form id="formRecover" action="auth/recover" method="POST">
                    <ul ui-implements='form' class='list'>
                        <li class='comp'>
                            <div>
                                <label for='emailRecover'>Correo:</label>
                                <span data-error="email"></span>
                            </div>
                            <aside>
                                <input id="emailRecover" name="email" type="email" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                    </ul>
                    <div class='horizontal centered'>
                        <button type="submit" id="recoverExecute" class="actionBtn" >Recuperar</button>
                    </div>
                </form>
            </section>
        </article>

        <nav class="next">
            <h1>BarrioOS Inicio</h1>
            <button class='show-popover button' id="showOptions">opciones</button>
        </nav>
        <article id="dashboard" class="next">

        </article>
        <nav>
            <button class='back' id="cancelUpdate" >Cancelar</button>
            <h1>Perfil</h1>
            <button class='done align-flush' id="executeUpdate" >Guardar</button>
        </nav>
        <article id="profile">

        </article>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/facebookConnectPlugin.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
        <script type="text/javascript">

            function getImage() {

                try {

                    navigator.camera.getPicture(
                            function(imageData){
                                readMedia(imageData)
                            },
                            function(error){
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido ha salido mal, estamos corrigiendo todos los errores lo más pronto posible',
                                        'Hecho',
                                        '',
                                        'popupRegister');

                                return false;
                                //navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                            },
                            {
                                quality: 80,
                                allowEdit : true,
                                destinationType: Camera.DestinationType.FILE_URI,
                                sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,
                                encodingType: Camera.EncodingType.JPEG,
                                targetWidth: 150,
                                targetHeight: 150,
                                mediaType:2
                            }
                    );
                }catch(err){

                    showPopup('Lo sentimos :(' ,
                            'Algo ha salido ha salido mal, estamos corrigiendo todos los errores lo más pronto posible',
                            'Hecho',
                            '',
                            'popupRegister');
                }
            }

            var login = function () {
                if (!window.cordova) {
                    //var appId = prompt("Enter FB Application ID", "");
                    facebookConnectPlugin.browserInit("1017010178318950");
                }
                facebookConnectPlugin.login( ["email","public_profile"],
                        function (response) {

                            //alert(JSON.stringify(response));
                            apiTest();

                        },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var showDialog = function () {
                facebookConnectPlugin.showDialog( { method: "feed" },
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var apiTest = function () {
                facebookConnectPlugin.api( "me/?fields=id,email,first_name,last_name", [],
                        function (response) {

                            var user = {}
                            user.provider_id = response.id;
                            user.email = response.email;
                            user.avatar_standar= "http://graph.facebook.com/"+response.id+"/picture?type=large";
                            user.avatar_thumbnail= "http://graph.facebook.com/"+response.id+"/picture?type=small";
                            user.first_name = response.first_name;
                            user.last_name = response.last_name;

                            $.ajax({
                                url: "http://www.proyectodes.net/api/auth/provider",
                                type: "POST",
                                data: user,
                                beforeSend: function(){
                                    $.UIPopup({empty: true});
                                    $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                    $('.popup').find('.busy').UICenter('relative');
                                },
                                success: function(response){
                                    $('.popup').UIPopupClose();
                                    window.localStorage.setItem("user", JSON.stringify(response));
                                    goToDashboard();
                                },
                                error: function(e){

                                    $('.popup').UIPopupClose();
                                    alert(JSON.stringify(e.responseJSON));

                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta iniciar nuevamente',
                                            'Hecho',
                                            '',
                                            'popupRegister');
                                }
                            });

                        },
                        function (response) {
                            showPopup('Lo sentimos :(' ,
                                    'Algo ha salido mal intenta iniciar nuevamente',
                                    'Hecho',
                                    '',
                                    'popupRegister');
                            alert(JSON.stringify(response))
                        });
            }

            var getAccessToken = function () {
                facebookConnectPlugin.getAccessToken(
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var getStatus = function () {
                facebookConnectPlugin.getLoginStatus(
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var logout = function () {
                facebookConnectPlugin.logout(
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            function readMedia(archivo){

                var imagenURL=archivo;

                window.resolveLocalFileSystemURL = window.resolveLocalFileSystemURL || window.webkitResolveLocalFileSystemURL;
                window.resolveLocalFileSystemURL(imagenURL, function(fileEntry) {
                    fileEntry.file(function(file){
                        var reader = new FileReader();
                        reader.onloadend = function(evt) {

                            IMAGE_DATA=evt.target.result;
                            $("#avatarContainer").html("<img src='" + IMAGE_DATA + "' height='150' width='150' />");


                        };
                        reader.readAsDataURL(file);
                    }, function(e){
                        alert(JSON.stringify(e));
                    })
                });

                return false;
            }

        </script>
    </body>
</html>
