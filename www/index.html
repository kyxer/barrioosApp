<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
    <head>
        <meta charset="utf-8" />
       <!-- <meta name="format-detection" content="telephone=no" /> -->

        <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="msapplication-tap-highlight" content="no">

        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <script src="js/jquery-2.1.4.min.js"></script>
        <script src="js/chui-3.8.10.min.js"></script>
        <script src="js/jqrcode.min.js"></script>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="css/menu.css">

        <!--<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" /> -->
        <title>BarrioOS</title>
       <!-- <style type="text/css" media="all">
            /* Set background color for invalid inputs: */
            input:focus:invalid {
                background-color: rgba(225,0,0,0.05);
            }
            .horizontal.centered {
                margin-top: 20px;
                display: -webkit-box;
                display: -webkit-flex;
                display: flex;
                -webkit-box-orientation: horizontal;
                -webkit-flex-direction: row;
                -ms-flex-direction: row;
                flex-direction: row;
                -wekbit-box-pack: center;
                -wekbit-justify-content: center;
                -ms-justify-content: center;
                justify-content: center;
            }
            button {
                display: inline-block;
                margin: auto;
                width: auto;
            }
        </style>
        <style type="text/css" media="all">
            .col {
                padding: 20px 10px;
                /*border: solid 1px #ccc;
                background-color: #fff;*/
                color: #000;
                padding: 10px;
                text-align: center;
            }
            .col p {
                margin: 0;
            }
            .fixed1 {
                -webkit-box-flex: none;
                -webkit-flex: none;
                -ms-flex: none;
                flex: none;
                width: 400px;
                background-color: #eee !important;
            }
            .fixed2 {
                -webkit-box-flex: none;
                -webkit-flex: none;
                -ms-flex: none;
                flex: none;
                width: 300px;
                background-color: #eee !important;
            }

            @media all and (max-width: 599px) {
                .fixed1, .fixed2 {
                    width: auto;
                }
            }
            .isWindows .grid > .col > p {
                color: #000 !important;
            }
            .isWindows h2 {
                margin-top: 20px;
                margin-bottom: 20px;
            }

            /*For raiting*/
            .rating {

                unicode-bidi: bidi-override;
                direction: rtl;
            }
            .rating > span {
                font: 30px Georgia, serif;
                display: inline-block;
                position: relative;
                width: 1.1em;
                color:gold;
            }
            .rating > span:before {
                content: "\2605";
                position: absolute;
            }
            /* Popup Demo Styles */
            #popupMessageTarget {
                opacity: 0;
                font-size: 14pt;
                line-height: 16pt;
                font-weight: 200;
                font-family: SegoeWP, SegoeUI, HelveticaNeue, Roboto, Sans-serif;
                padding: 0 15px;
            }
            .animatePopupMessage {
                -webkit-animation-duration: 2s;
                -webkit-animation-timing-function: linear;
                -webkit-animation-name: updatePopupMessage;
                animation-duration: 2s;
                animation-timing-function: linear;
                animation-name: updatePopupMessage;
            }
            @-webkit-keyframes updatePopupMessage {
                0% { opacity: 0; }
                20% { opacity: 1; }
                90% { opacity: 1; }
                100% { opacity: 0; }
            }

            @keyframes updatePopupMessage {
                0% { opacity: 0; }
                20% { opacity: 1; }
                90% { opacity: 1; }
                100% { opacity: 0; }
            }

            .hasError{
                color:darkred !important;
            }

            .isAndroid .actionBtn{
                background: #276527 !important;
                color: whitesmoke !important;
            }

            .isAndroid .secondBtn{
                background: #3066a0 !important;
                color: whitesmoke !important;
            }

            .btn-facebook {
                color: #fff !important;
                background-color: #3b5998;
                border: 1px solid #335190;
            }

            .btn-facebook:hover,
            .btn-facebook:focus {
                color: #fff;
                background-color: #294786;
            }

            input[type="file"]{
                z-index: 999;
                line-height: 0;
                position: absolute;
                opacity: 0;
                filter: alpha(opacity = 0);-ms-filter: "alpha(opacity=0)";
                margin: 0;
                padding:0;
                cursor: pointer;
            }

            .backgroundDashboard{

                background: rgba(17,44,75,1);
                background: -moz-linear-gradient(left, rgba(17,44,75,1) 7%, rgba(17,44,75,1) 7%, rgba(23,51,84,1) 11%, rgba(115,172,230,1) 76%, rgba(115,172,230,1) 80%);
                background: -webkit-gradient(left top, right top, color-stop(7%, rgba(17,44,75,1)), color-stop(7%, rgba(17,44,75,1)), color-stop(11%, rgba(23,51,84,1)), color-stop(76%, rgba(115,172,230,1)), color-stop(80%, rgba(115,172,230,1)));
                background: -webkit-linear-gradient(left, rgba(17,44,75,1) 7%, rgba(17,44,75,1) 7%, rgba(23,51,84,1) 11%, rgba(115,172,230,1) 76%, rgba(115,172,230,1) 80%);
                background: -o-linear-gradient(left, rgba(17,44,75,1) 7%, rgba(17,44,75,1) 7%, rgba(23,51,84,1) 11%, rgba(115,172,230,1) 76%, rgba(115,172,230,1) 80%);
                background: -ms-linear-gradient(left, rgba(17,44,75,1) 7%, rgba(17,44,75,1) 7%, rgba(23,51,84,1) 11%, rgba(115,172,230,1) 76%, rgba(115,172,230,1) 80%);
                background: linear-gradient(to right, rgba(17,44,75,1) 7%, rgba(17,44,75,1) 7%, rgba(23,51,84,1) 11%, rgba(115,172,230,1) 76%, rgba(115,172,230,1) 80%);
                filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#112c4b', endColorstr='#73ace6', GradientType=1 );
            }

            .backgroundDashboard p {
                color: white !important;
            }

        </style> -->
        <script id="dashboardTemplate" type="text/x-template">
            <section class="tarjeta">
                <div class="row">
                    <div class="col-xs-12 text-left">
                        <h3 class="text-left">Vecino de</h3>
                        <h2 class="localidad">[[= data.barrio ]]</h2>
                    </div>
                </div>
                <div class="row qr">
                    <div class="col-xs-5">
                        <a href="avatar.html">
                            <img src="[[= data.avatar_standar  ]]" alt="[[= data.first_name  ]]" class="img-circle"  style="margin-top:2vh;">
                        </a>
                    </div>
                    <div class="col-xs-7">
                        <h2>[[= data.first_name  ]]</h2>
                        <h1><i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i></h1>
                        <h4>[[= data.rating  ]]</h4>
                    </div>
                </div>
                <div style="display: none" id="containerCodeBidi" class="col-xs-12 text-center">
                </div>
                <!--<div class="grid gutter-5">
                    <div class="col flex-3">
                        <p>Vecino de</p>
                        <p>[[= data.barrio ]]</p>
                    </div>
                    <div class="col flex-3">
                        <p>BarrioOS</p>
                    </div>
                </div>
                <div class="grid gutter-5">
                    <p id="popupMessageTarget" class="attentionGrapper"></p>
                    <div id="dashboardImg" class="col flex-3">
                        <img title="[[= data.first_name  ]]" src="[[= data.avatar_standar  ]]" height="150px">
                    </div>
                    <div class="col flex-3">
                        <div class="rating">
                            <p>[[= data.first_name ]]</p>
                            <span>☆</span><span>☆</span><span>☆</span><span>☆</span><span>☆</span>
                            </div>
                        <br>
                        <div style="display: none" id="containerCodeBidi"></div>
                    </div>
                </div> -->
            </section>
        </script>
        <script id="profileTemplate" type="text/x-template">
            <section class="perfil">
                <div class="row">
                    <div class="col-xs-12">
                        <p id="popupUpdate" class="attentionGrapper"></p>
                        <form id="formUpdate" action="users/me" method="PUT" class="form-horizontal">
                            <div class="form-group">
                                <label for="first_name" class="col-xs-4 control-label">Nombre</label>
                                <div class="col-xs-8">
                                    <input id="firstNameUpdate" name="first_name" value="[[= data.first_name ]]" type="text" autocapitalize="words" class="form-control" autocorrect="off" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="last_name" class="col-xs-4 control-label">Apellidos</label>
                                <div class="col-xs-8">
                                    <input id="lastNameUpdate" name="last_name" value="[[= data.last_name ]]" type="text" autocapitalize="words" class="form-control" autocorrect="off" >
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email" class="col-xs-4 control-label">Correo</label>
                                <div class="col-xs-8">
                                  <input id="emailUpdate" name="email" type="email" value="[[= data.email ]]" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com"  autocapitalize="off" autocorrect="off" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email_confirmation" class="col-xs-4 control-label">Repita Correo</label>
                                <div class="col-xs-8">
                                  <input id="emailUpdateRe" name="email_confirmation" type="email" value="[[= data.email ]]" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" autocapitalize="off" autocorrect="off" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="postal_code" class="col-xs-4 control-label" id="r-con">Código Postal</label>
                                <div class="col-xs-8">
                                    <input id="postalCodeUpdate" name="postal_code" type="text" value="[[= data.postal_code ]]" pattern="^\d+$" title="Solo números" autocapitalize="off" autocorrect="off" class="form-control" class="form-control" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="phone" class="col-xs-4 control-label">Teléfono</label>
                                <div class="col-xs-8">
                                  <input id="phoneUpdate" name="phone" type="text" value="[[= data.phone ]]" maxlength="20" autocapitalize="off" class="form-control" autocorrect="off">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="address" class="col-xs-4 control-label">Dirección</label>
                                <div class="col-xs-8">
                                  <textarea id="addressUpdate" name="address" type="text" maxlength="200" class="form-control" autocorrect="off">[[= data.address ]]</textarea>
                                </div>
                            </div>
                            <div class="col-xs-offset-4 col-xs-8">
                            <a id="goToAvatar" class="btn btn-default btn-block" id="cambiaravatar">Cambiar Avatar</a>
                            </div>
                            </div>


                            <div class="form-group">
                            <div class="col-xs-12 text-center">
                              <button id="executeUpdate" class="btn btn-primary btn-lg btn-block">Guardar Cambios</button>
                            </div>
                            </div>
                            </form>

                        </div>
                    </div>
                </div>
            </section>
            <!--<section>
                <p id="popupUpdate" class="attentionGrapper"></p>
                <h2>Edita tu información</h2>
                <form id="formUpdate" action="users/me" method="PUT" >
                    <ul class='list' ui-implements='form'>
                        <li class="comp">
                            <div>
                                <label for="firstNameUpdate">Nombre:</label>
                                <span data-error="first_name"></span>
                            </div>
                            <aside>
                                <input id="firstNameUpdate" name="first_name" value="[[= data.first_name ]]" type="text" autocapitalize="words" autocorrect="off" required>
                            </aside>
                        </li>
                        <li class="comp">
                            <div>
                                <label for="lastNameUpdate">Apellido:</label>
                                <span data-error="last_name"></span>
                            </div>
                            <aside>
                                <input id="lastNameUpdate" name="last_name" value="[[= data.last_name ]]" type="text" autocapitalize="words" autocorrect="off" >
                            </aside>
                        </li>
                        <li class="comp">
                            <div>
                                <label for="emailUpdate">Correo:</label>
                                <span data-error="email"></span>
                            </div>
                            <aside>
                                <input id="emailUpdate" name="email" type="email" value="[[= data.email ]]" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com"  autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                        <li class="comp">
                            <div>
                                <label for="emailUpdateRe">Repita Correo:</label>
                                <span data-error="email_confirmation"></span>
                            </div>
                            <aside>
                                <input id="emailUpdateRe" name="email_confirmation" type="email" value="[[= data.email ]]" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                        <li class='comp'>
                            <div>
                                <label for='postalCodeUpdate'>Código Postal:</label>
                                <span data-error="postal_code"></span>
                            </div>
                            <aside>
                                <input id="postalCodeUpdate" name="postal_code" type="text" value="[[= data.postal_code ]]" pattern="^\d+$" title="Solo números" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                    </ul>
                    <br>
                    <ul class='list' ui-implements='form'>
                        <li class='comp'>
                            <div>
                                <label for='phoneUpdate'>Telefono:</label>
                                <span data-error="phone"></span>
                            </div>
                            <aside>
                                <input id="phoneUpdate" name="phone" type="text" value="[[= data.phone ]]" maxlength="20" autocapitalize="off" autocorrect="off">
                            </aside>
                        </li>
                        <li class='comp'>
                            <div>
                                <label for='addressUpdate'>Direccion:</label>
                                <span data-error="address"></span>
                            </div>
                            <aside>
                                <input id="addressUpdate" name="address" type="text" maxlength="200" value="[[= data.address ]]" autocapitalize="off" autocorrect="off">
                            </aside>
                        </li>
                    </ul>
                    <br>
                    <ul class='list'>
                        <li class='nav' id="goToAvatar">
                            <h3>Cambiar Avatar</h3>
                        </li>
                    </ul>
                </form>
            </section> -->
        </script>
        <script id="avatarTemplate" type="text/x-template">
            <section class="qr-sec">
                <div class="row">
                    <div id="avatarContainer" class="col-xs-12 text-center">
                            <img src="[[= data.avatar_standar  ]]" alt="Persona" class="img-circle margin">
                    </div>
                    <div class="col-xs-12 text-center">
                            <a id="avatarButton" class="btn btn-primary btn-lg">Seleccionar Avatar</a>
                    </div>
                </div>
            </section>
            <!--<section>
                <div class="grid center gutter-5">
                    <div id="avatarContainer" class="col flex-10">
                        <img src='[[= data.avatar_standar  ]]' height="150" />
                    </div>
                </div>
                <div class="grid center gutter-5">
                    <div class="col flex-10">
                            <div class='horizontal centered'>
                                <button id="avatarButton"> Seleccionar Avatar </button>
                            </div>

                    </div>
                </div>
            </section> -->
        </script>
        <script id="qrCodeTemplate" type="text/x-template">
            <section class="qr-sec">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="embajador text-center">
                            <img src="[[= data.code  ]]" alt="QR">
                            <h2>[[= data.number  ]]</h2>
                        </div>
                    </div>
                </div>
            </section>
        </script>
        <script>
            $(function() {

                setTimeout(function() {
                        $("body").fadeIn();
                    });

                //if($.isAndroid || $.isChrome){
                    $("head").append("<link rel='stylesheet' type='text/css' href='css/themeAndroid.css' />");
                    setTimeout(function() {
                        $("body").fadeIn();
                    });
                /*}
                else{
                    $("head").append("<link rel='stylesheet' type='text/css' href='css/themeIos.css' />");
                    setTimeout(function() {
                        $("body").fadeIn();
                    });
                }*/

                var user = JSON.parse(window.localStorage.getItem('user'));
                console.log(user);
                /*var optionsContent = "<ul class='list'><li id='goToProfile' ><h3>Perfil</h3></li><li id='signOut'><h3>Cerrar Sesion</h3></li></ul>";*/
                var myDashboardTmpl = $.template($("#dashboardTemplate").text());
                var myProfileTmpl = $.template($("#profileTemplate").text());
                var myAvatarTmpl = $.template($("#avatarTemplate").text());
                var myQrCodeTmpl = $.template($("#qrCodeTemplate").text());

                goToDashboard = function(){

                    $.UIGoToArticle('#dashboard');

                    if($("#dashboard").text().trim()!="")
                        return;

                    var user = JSON.parse(window.localStorage.getItem('user'));
                    var codeBidi = window.localStorage.getItem('codeBidi');
                    $('#dashboard').html(myDashboardTmpl(user));
                    if(codeBidi){
                        $("#containerCodeBidi").html('<img src="'+ codeBidi +'" class="qr-img" />');
                        $("#containerCodeBidi").fadeIn();
                    }
                    else
                    {
                        setTimeout(function(){
                            var qrcode = new QRCode("containerCodeBidi", {
                                text: "http://www.proyectodes.net/users/"+user.id,
                                width: 270,
                                height: 270,
                                colorDark : "#000000",
                                colorLight : "#ffffff",
                                correctLevel : QRCode.CorrectLevel.H
                            });
                            /*$('#containerCodeBidi img').attr({
                                height:'80px'
                            });*/

                            setTimeout(function(){
                                window.localStorage.setItem('codeBidi',$('#containerCodeBidi img').attr('src'));
                                $("#containerCodeBidi").html('<img src="'+ $('#containerCodeBidi img').attr('src') +'" class="qr-img" />');
                                $("#containerCodeBidi").fadeIn();
                            },500)

                        }, 500);
                    }

                    $("#containerCodeBidi").on("singletap", function() {

                        $.UIGoToArticle("#qrCode");
                        if($("#qrCode").text().trim()!="")
                            return;

                        $('#qrCode').html(myQrCodeTmpl({
                            number: user.bidicode.toString(),
                            code:$('#containerCodeBidi img').attr('src')
                        }));

                        /*showPopup( show ,
                                '<img  src="'+src+'" height="270px">',
                                'Salir',
                                '',
                                'popupMessageTarget');*/
                    });
                }

                var goToProfile = function(){
                    $.UIGoToArticle('#profile');

                    user = JSON.parse(window.localStorage.getItem('user'));

                    if($("#profile").text().trim()!="")
                        return;

                    $('#profile').html(myProfileTmpl(user));

                    $("#goToAvatar").on("singletap", function(){
                        goToAvatar('profile');
                    });

                    $("#formUpdate").on("submit", function (e) {

                        e.preventDefault();

                        if(!validateConfirmation("formUpdate","emailUpdate", "email", "Correos" )){
                            return false;
                        }

                        doAjax({
                            identifier:"formUpdate",
                            beforeSend: function(){
                                cleanFormErrors("formUpdate");
                                $.UIPopup({empty: true});
                                $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                $('.popup').find('.busy').UICenter('relative');

                            },
                            success:function(response){

                                $('.popup').UIPopupClose();

                                showPopup('Exito al actualizar tu información' ,
                                        'Haz actualizado tu información correctamente',
                                        'Hecho',
                                        '',
                                        'popupUpdate');

                                window.localStorage.setItem("user", JSON.stringify(response));
                            },
                            error:function(response){
                                $('.popup').UIPopupClose();

                                if(response.responseJSON.status_code == 422)
                                {
                                    var errors = response.responseJSON.errors;
                                    var $form = $("#formUpdate");
                                    $.each(errors, function(key, value) {
                                        var sel = $form.find("span[data-error='"+ key +"']");
                                        $(sel).html(value);
                                        $(sel).parent().addClass('hasError');
                                    });
                                }
                                else
                                {
                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta solicitando dentro de un momento',
                                            'Hecho',
                                            '',
                                            'popupUpdate');
                                }
                            }
                        })
                    });
                }
                GLOBAL_VAR_AVATAR_DONE = 1;
                var goToAvatar = function(navigation){

                    $.UIGoToArticle('#avatar');

                    if(navigation == 'profile') {
                        $('#avatarBack').show();
                    }
                    else{
                        $('#avatarBack').hide();
                    }
                    navigationAvatar = navigation;
                    if($("#avatar").text().trim()!="")
                        return;

                    var user = JSON.parse(window.localStorage.getItem('user'));
                    $('#avatar').html(myAvatarTmpl(user));

                    $("#avatarButton").on("singletap", function(){
                        getImage();
                    });

                    $('#avatarDone').on('singletap', function (){
                        if(GLOBAL_VAR_AVATAR_DONE == 0)
                            return;
                        GLOBAL_VAR_AVATAR_DONE = 0;

                        if(typeof IMAGE_DATA == "undefined"){
                            if(navigationAvatar == 'profile') {

                                $.UIGoBackToArticle('#profile');
                                GLOBAL_VAR_AVATAR_DONE = 1;

                            }
                            else
                            {
                                goToDashboard();
                                GLOBAL_VAR_AVATAR_DONE = 1;
                            }
                        }
                        else{
                            $.ajaxSetup({
                                headers: { 'Authorization': 'Bearer ' + user.token }
                            });

                            $.ajax({
                                url: "http://des.barrioosger.com/api/users/me/avatar",
                                type: "POST",
                                data: { avatar: IMAGE_DATA.toString() },
                                beforeSend:function(){
                                    $.UIPopup({empty: true});
                                    $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                    $('.popup').find('.busy').UICenter('relative');
                                },
                                success:function(response){
                                    GLOBAL_VAR_AVATAR_DONE = 1;
                                    $('#dashboardImg').html("<img src='" + IMAGE_DATA + "' height='150' width='150' />")


                                    IMAGE_DATA = undefined;

                                    window.localStorage.setItem("user", JSON.stringify(response));

                                    if(navigationAvatar == 'profile') {
                                        setTimeout(function() {
                                            $.UIGoBackToArticle('#profile');
                                        }, 300);

                                    }
                                    else
                                    {
                                        setTimeout(function() {
                                            goToDashboard();
                                        }, 300);

                                    }
                                    $('.popup').UIPopupClose();
                                },
                                error: function (response) {
                                    GLOBAL_VAR_AVATAR_DONE = 1;

                                    $('.popup').UIPopupClose();
                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta subir el avatar nuevamente',
                                            'Hecho',
                                            '',
                                            'popupRegister');

                                }
                            });
                        }
                    });
                };



                var doAjax = function(options){
                    var user = JSON.parse(window.localStorage.getItem('user'));

                    var url = "http://des.barrioosger.com/api/";

                    if(user){
                        $.ajaxSetup({
                            headers: { 'Authorization': 'Bearer ' + user.token }
                        });
                    }
                    $.ajax({
                        url: url + $('#'+ options.identifier).attr("action"),
                        type: $('#'+ options.identifier).attr("method"),
                        data: $('#'+ options.identifier).serialize(),
                        beforeSend: options.beforeSend,
                        success: options.success,
                        error: options.error
                    });
                }

                var validateConfirmation = function(form, identifier, keyDataError, Message){

                    if($("#"+identifier).val() != $("#"+identifier+"Re").val()){
                        $("#"+ form +" span[data-error='"+keyDataError+"']").html(Message+" no coiciden");
                        $("#"+ form +" span[data-error='"+keyDataError+"']").parent().addClass("hasError");
                        $("#"+ form +" span[data-error='"+keyDataError+"_confirmation']").html(Message+" no coiciden");
                        $("#"+ form +" span[data-error='"+keyDataError+"_confirmation']").parent().addClass("hasError");
                        return false;
                    }
                    return true;
                }

                var cleanFormErrors = function(form){
                    $("#"+form+" li div").removeClass('hasError');
                    $("#"+form+" li div span[data-error]").html("");
                    $("#"+form+" h3[data-error]").html("");
                }

                showPopup = function(title , message, cancelTitle, continueTitle, popupIdCallback ){
                    $.UIPopup({
                        id: "warning",
                        title: title,
                        message: message,
                        cancelButton: cancelTitle,
                        continueButton: continueTitle,
                        callback: function() {
                            var popup = document.querySelector('#'+popupIdCallback);
                            popup.textContent = 'Thanks for staying with us a bit longer.';
                            popup.classList.remove("animatePopupMessage");
                            popup.classList.add("animatePopupMessage");
                        }
                    });
                }

                if(user){
                    goToDashboard();
                }

                $("#formLogin").on("submit", function (e) {
                    e.preventDefault();
                    doAjax({
                        identifier:"formLogin",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            //Clean errors
                            cleanFormErrors("formLogin");

                        },
                        success:function(response){

                            $('.popup').UIPopupClose();

                            $("#formLogin")[0].reset();
                            window.localStorage.setItem("user", JSON.stringify(response));

                            goToDashboard();
                        },
                        error:function(response){
                            $('.popup').UIPopupClose();
                            if(response.responseJSON.status_code == 403){
                                var sel = $("#formLogin").find("h3[data-error='validation']");
                                $(sel).html("Su correo o contraseña son invalidos");
                            }
                            else
                            {
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta iniciar sesion nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRegister');
                            }
                        }
                    })
                });

                $("#formRegister").on("submit", function (e) {
                    e.preventDefault();

                    if(!validateConfirmation("formRegister","emailSignup", "email", "Correos" )){
                        return false;
                    }

                    if(!validateConfirmation("formRegister","passwordSignup", "password", "Contraseñas" )){
                        return false;
                    }

                    doAjax({
                        identifier:"formRegister",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            cleanFormErrors("formRegister");

                        },
                        success:function(response){
                            $("#formRegister")[0].reset();
                            $('.popup').UIPopupClose();
                            window.localStorage.setItem("user", JSON.stringify(response));
                            goToAvatar();

                        },
                        error:function(response){

                            $('.popup').UIPopupClose();

                            if(response.responseJSON.status_code == 422){
                                var errors = response.responseJSON.errors;
                                var $form = $("#formRegister");
                                $.each(errors, function(key, value) {
                                    var sel = $form.find("span[data-error='"+ key +"']");
                                    $(sel).html(value);
                                    $(sel).parent().addClass('hasError');
                                });
                            }
                            else
                            {
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta registrarte nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRegister');
                            }

                        }
                    })
                });

                $("#formRecover").on("submit", function (e) {
                    e.preventDefault();
                    doAjax({
                        identifier:"formRecover",
                        beforeSend: function(){
                            $.UIPopup({empty: true});
                            $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                            $('.popup').find('.busy').UICenter('relative');
                            cleanFormErrors("formRecover");

                        },
                        success:function(response){

                            $('.popup').UIPopupClose();

                            $('#formRecover')[0].reset();

                            showPopup('Exito al enviar la solicitud' ,
                                    'Un correo de recuperación ha sido enviado a tu email',
                                    'Hecho',
                                    '',
                                    'popupRecover');
                        },
                        error:function(response){

                            $('.popup').UIPopupClose();

                            if(response.responseJSON.status_code == 404){
                                var $form = $("#formRecover");
                                var sel = $form.find("span[data-error='email']");
                                $(sel).html("Este correo no se encuentra");
                                $(sel).parent().addClass('hasError');

                            }else{
                                showPopup('Lo sentimos :(' ,
                                        'Algo ha salido mal intenta solicitando tu contraseña nuevamente',
                                        'Hecho',
                                        '',
                                        'popupRecover');
                            }



                        }
                    })
                });

                // This is just an animation for popup callback,
                // Not part of popup functionality.
                $("#popupMessageTarget").on("webkitAnimationEnd", function() {
                    this.className = "";
                    this.textContent = "";
                });



                /*var popoverEventHandler = function() {

                    $("#goToProfile").on("singletap", function () {
                        goToProfile();
                    });

                    $("#signOut").on("singletap", function(){
                        $.UIPopoverClose();

                        window.localStorage.removeItem("user");
                        window.localStorage.removeItem("codeBidi");
                        //logout();
                        $("#dashboard").children().remove();
                        $("#avatar").children().remove();
                        $("#profile").children().remove();
                        $("#avatarDone").unbind();
                        $.UIGoBackToArticle("#main");

                    });

                    $('.popover').on('singletap', function(e) {
                            if ($.isAndroid || $.isChrome) {
                                setTimeout(function() {
                                    $.UIPopoverClose();
                                }, 300);
                            } else {
                                $.UIPopoverClose();
                            }
                        });
                    };

                    $('#showOptions').on('singletap', function() {
                    var trigger = this;
                        $.UIPopover({
                            title: 'Opciones',
                            trigger: trigger,
                            content: optionsContent,
                            callback: function() {
                                popoverEventHandler();
                            }
                    });
                });*/

                $("#loginFacebook").on("singletap", function(){
                    login();
                });

                $("#goTologin").on("singletap", function () {
                    $.UIGoToArticle("#login");
                });

                $("#goToForgotPassword").on("singletap", function () {
                    $.UIGoToArticle("#forgotPassword");
                });

                $("#goToSignup").on("singletap", function () {
                    $.UIGoToArticle("#signup");
                });

                $("#goToDashboard").on("singletap", function () {
                    $.UIGoToArticle("#dashboard");
                });

                $("#executeUpdate").on("singletap", function(){
                    $("#formUpdate").submit();
                });

                $("#goToProfile").on("click", function () {
                    goToProfile();
                });

                $("#signOut").on("click", function(){
                    //$.UIPopoverClose();

                    window.localStorage.removeItem("user");
                    window.localStorage.removeItem("codeBidi");
                        //logout();
                    $("#dashboard").children().remove();
                    $("#avatar").children().remove();
                    $("#profile").children().remove();
                    $("#avatarDone").unbind();
                    $.UIGoBackToArticle("#main");

                });

                $('.toggle-menu').jPushMenu({
                    closeOnClickLink: false
                });


            });
        </script>
        <style type="text/css">
            section{
                background: transparent !important;
            }
            #global-nav{
                background-color: #1974c1 !important;
            }
        </style>

    </head>
    <body  id="index" style="display: none">
        <!--
        /
        /  MAIN PAGE
        /
        -->
        <article id="main">
            <section class="index">
                <!--<div class="grid center gutter-5">
                    <div class="col flex-8">

                        <p>Bienvenidos a BarrioOS</p>

                        <div class='horizontal centered' >
                            <button id="goTologin" class="actionBtn">Iniciar Sesion</button>
                        </div>

                        <div class='horizontal centered'>
                            <button id="goToSignup" class="secondBtn">Registrarse</button>
                        </div>
                        <div class='horizontal centered'>
                            <button id="loginFacebook" class="btn-facebook">
                                <i class="ion-social-facebook"></i> Inicia con Facebook
                            </button>
                        </div>
                    </div>
                </div> -->
                <div class="text-center">
                    <img src="images/barrioos-vertical.png" alt="BarrioOS" width="150px" height="auto">
                    <h3>Conecta con tu Barrio</h3>
                </div>
                <div class="index-fb">
                    <div class="col-xs-12 text-center">
                        <div class="row fb">
                            <a id="loginFacebook" >
                                    <i class="fa fa-facebook"></i>
                                    <p>Registrate con Facebook <br>
                                    <small>No publicaremos nada en tu muro</small></p>
                            </a>
                        </div>
                      <a id="goTologin" class="btn btn-default btn-lg pull-left" >Ingresar</a>
                      <a id="goToSignup" class="btn btn-default btn-lg pull-right">Registrar</a>
                    </div>
                </div>
            </section>
        </article>
        <!--<nav class="next">
            <button class="back">BarrioOS</button>
            <h1>Iniciar Sesión</h1>
            <button id="goToForgotPassword" >¿Contraseña?</button>
        </nav> -->
        <nav class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
              <a class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i style="color: #1974C1" class="fa fa-arrow-left"></i>
            </a>
              <h1 class="text-left title">Ingresar</h1>
              <a class="navbar-brand" id="b-barrioos" ><img src="images/barrioos-iso.png" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="login" class="next">
            <section class="ingresar">
                <!--<h2>Inicia Sesión</h2>
                <form id="formLogin" action="auth/login" method="POST" >
                    <h3 data-error="validation" class="hasError"></h3>
                    <ul ui-implements='form' class='list'>
                        <li class='comp'>
                            <div>
                                <label for="emailLogin">Correo:</label>
                            </div>
                            <aside>
                                <input id="emailLogin" name="email" type="email" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                        <li class='comp'>
                            <div>
                                <label for='passwordLogin'>Contraseña:</label>
                            </div>
                            <aside>
                                <input id="passwordLogin" name="password" type="password" maxlength="16" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                    </ul>
                    <div class='horizontal centered'>
                        <button type="submit" class="actionBtn" >Iniciar Sesión</button>
                    </div>
                </form> -->
                <div class="row">
                    <div class="col-xs-10 col-xs-offset-1">
                        <form id="formLogin" action="auth/login" method="POST" class="form-horizontal" >
                          <h3 data-error="validation" class="hasError"></h3>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="emailLogin" name="email" type="email" autocapitalize="off" autocorrect="off" placeholder="Correo" class="form-control" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                                <input id="passwordLogin" name="password" type="password" maxlength="16" autocapitalize="off" autocorrect="off" placeholder="Contraseña" class="form-control" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12 text-center submitregistro">
                                <button style="margin:0px" type="submit" class="btn btn-default btn-lg btn-block" >Ingresar</button>
                            </div>
                          </div>
                          <div style="padding-top:20px" class="form-group">
                            <div class="col-xs-12 text-center">
                                <a id="goToForgotPassword" style="color:white;font-size:18px;">¿Haz olvidado tu contraseña?</a>
                            </div>
                          </div>

                        </form>
                    </div>
                </div>
            </section>
        </article>
        <!--<nav class="next">
            <button class="back">BarrioOS</button>
            <h1>Registrarse</h1>
        </nav> -->
        <nav class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
              <a class="navbar-toggle menu-left back" data-toggle="collapse" aria-expanded="false">
                <i style="color: #1974C1" class="fa fa-arrow-left"></i>
            </a>
              <h1 class="text-left title" >Registro</h1>
              <a class="navbar-brand" id="b-barrioos"><img src="images/barrioos-iso.png" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="signup" class="next">
            <section class="registro">
                <p id="popupRegister" class="attentionGrapper"></p>
                <!--<h2>Registrate</h2>
                <form id="formRegister" action="auth/register" method="POST">
                    <ul class='list' ui-implements='form'>
                    <li class="comp">
                        <div>
                            <label for="nameSignup">Nombre de Pila: </label>
                            <span data-error="first_name"></span>
                        </div>

                        <aside>
                            <input id="nameSignup" name="first_name" type="text" autocapitalize="words" autocorrect="off" required>
                        </aside>

                    </li>
                    <li class="comp">
                        <div>
                            <label for="emailSignup">Correo:</label>
                            <span data-error="email"></span>
                        </div>
                        <aside>
                            <input id="emailSignup" name="email" type="email" autocapitalize="off" autocorrect="off" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" required>
                        </aside>
                    </li>
                    <li class="comp">
                        <div>
                            <label for="emailSignupRe">Repita Correo:</label>
                            <span data-error="email_confirmation"></span>
                        </div>
                        <aside>
                            <input id="emailSignupRe" name="email_confirmation" type="email" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" autocapitalize="off" autocorrect="off" required>
                        </aside>
                    </li>
                    <li class='comp'>
                        <div>
                            <label for='passwordSignup'>Contraseña:</label>
                            <span data-error="password"></span>
                        </div>
                        <aside>
                            <input id="passwordSignup" name="password" type="password" maxlength="16" autocapitalize="off" autocorrect="off" required>
                        </aside>
                    </li>
                    <li class='comp'>
                        <div>
                            <label for='passwordSignupRe'>Repita Contraseña:</label>
                            <span data-error="password_confirmation"></span>
                        </div>
                        <aside>
                            <input id="passwordSignupRe" name="password_confirmation" maxlength="16" type="password" autocapitalize="off" autocorrect="off" required>
                        </aside>
                    </li>
                    <li class='comp'>
                        <div>
                            <label for='postalCodeSignup'>Código Postal:</label>
                            <span data-error="postal_code"></span>
                        </div>
                        <aside>
                            <input id="postalCodeSignup" name="postal_code" type="text" maxlength="5" pattern="^\d+$" title="Solo números" autocapitalize="off" autocorrect="off" required>
                        </aside>
                    </li>
                </ul>

                    <ul class='list' ui-implements='form'>
                    <li>
                        <p><small>Al hacer clic en Registrarse, aceptas los <a href="">términos y condiciones</a> y la <a href="">política de privacidad</a></small></p>
                    </li>
                </ul>
                    <button type="submit" class='action secondBtn'>Registrarse</button>
                </form> -->
                <div class="row">
                    <div class="col-xs-10 col-xs-offset-1">
                        <form id="formRegister" action="auth/register" method="POST" class="form-horizontal">
                            <div class="form-group">
                              <div class="col-xs-12">
                                <input id="nameSignup" name="first_name" type="text" autocapitalize="words" autocorrect="off" placeholder="Nombre de Pila" class="form-control" required>
                              </div>
                            </div>
                            <div class="form-group">
                              <div class="col-xs-12">
                                <input id="emailSignup" name="email" type="email" autocapitalize="off" autocorrect="off" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" class="form-control" placeholder="Correo" required>
                              </div>
                            </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="emailSignupRe" name="email_confirmation" type="email" pattern="^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$" title="example@dominio.com" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Repetir Correo" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="passwordSignup" name="password" type="password" maxlength="16" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Contraseña" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="passwordSignupRe" name="password_confirmation" maxlength="16" type="password" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Repetir Contraseña" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="postalCodeSignup" name="postal_code" type="text" maxlength="5" pattern="^\d+$" title="Solo números" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Código Postal" required>
                            </div>
                          </div>

                          <div class="checkbox">
                            <label>
                              Al Registrarse, aceptas los <a href="">términos y condiciones</a> y la <a href="">política de privacidad</a>
                            </label>
                          </div>

                          <div class="form-group">
                            <div class="col-xs-12 text-center submitregistro">
                              <button type="submit" class="btn btn-default btn-lg btn-block">Registrar</button>
                            </div>
                          </div>
                        </form>
                    </div>
                </div>
            </section>
        </article>
        <!--<nav>
            <button id="avatarBack" class="back"></button>
            <h1>Seleccionar Avatar</h1>
            <button id="avatarDone">Hecho</button>
        </nav> -->
        <nav style="border-color: transparent" class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
                <a id="avatarBack" class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i     style="color: #1974C1;" class="fa fa-arrow-left"></i>
                </a>
              <h1 class="text-left title">Tu Imagen</h1>
              <a class="navbar-brand" id="b-barrioos" ><img src="images/barrioos-iso.png" id="logo" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="avatar" style="background-color:white !important; z-index:0">
        </article>
        <nav class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
              <a class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i style="color: #1974C1" class="fa fa-arrow-left"></i>
            </a>
              <h1 style="font-size: 29px;" class="text-left title">Recuperar Contraseña</h1>
              <a class="navbar-brand" id="b-barrioos" ><img src="images/barrioos-iso.png" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="forgotPassword" class="next">
            <!--<section>
                <p id="popupRecover" class="attentionGrapper"></p>
                <h2>Solicita tu contraseña</h2>
                <form id="formRecover" action="auth/recover" method="POST">
                    <ul ui-implements='form' class='list'>
                        <li class='comp'>
                            <div>
                                <label for='emailRecover'>Correo:</label>
                                <span data-error="email"></span>
                            </div>
                            <aside>
                                <input id="emailRecover" name="email" type="email" autocapitalize="off" autocorrect="off" required>
                            </aside>
                        </li>
                    </ul>
                    <div class='horizontal centered'>
                        <button type="submit" id="recoverExecute" class="actionBtn" >Recuperar</button>
                    </div>
                </form>
            </section>-->
            <section class="ingresar">
                <div class="row">
                    <div class="col-xs-10 col-xs-offset-1">
                        <form id="formRecover" action="auth/recover" method="POST" class="form-horizontal" >
                          <div class="form-group">
                            <div class="col-xs-12">
                              <input id="emailRecover" name="email" type="email" autocapitalize="off" autocorrect="off" class="form-control" placeholder="Email" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-xs-12 text-center submitregistro">
                                <button id="recoverExecute" style="margin:0px" type="submit" class="btn btn-default btn-lg btn-block" >Recuperar</button>
                            </div>
                          </div>
                        </form>
                    </div>
                </div>
            </section>
        </article>
        <!--<nav class="next">
            <h1>BarrioOS Inicio</h1>
            <button class='show-popover button' id="showOptions">opciones</button>
        </nav> -->
        <nav style="border-color: transparent" class="navbar navbar-default navbar-fixed-top">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle toggle-menu menu-left jPushMenuBtn" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
              <h1 class="text-left title">Tarjeta</h1>
              <a class="navbar-brand" id="b-barrioos" href="index.html"><img src="images/barrioos-iso.png" id="logo" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
            <div style="height:1200px; top: 53px;" class="collapse navbar-collapse cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" id="bs-example-navbar-collapse-1">

              <ul class="nav navbar-nav navbar-left">
                  <li><a href="#" >Grupo</a></li>
                  <li><a href="#" >Chat</a></li>
                  <li id="goToProfile" ><a>Perfil</a></li>
                  <li id="signOut" ><a>Cerrar Sesión</a></li>
              </ul>
            </div>
        </nav>
        <article id="dashboard" style="background-color:white !important; z-index:0">

        </article>
        <nav style="border-color: transparent" class="navbar navbar-default navbar-fixed-top next">
            <div class="navbar-header">
              <a class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i style="color: #1974C1" class="fa fa-arrow-left"></i>
            </a>
              <h1 class="text-left title">Tú Código</h1>
              <a class="navbar-brand" id="b-barrioos" ><img src="images/barrioos-iso.png" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="qrCode" class="next" style="background-color:white !important; z-index:0" >

        </article>
        <!--<nav>
            <button class='back' id="cancelUpdate" >Cancelar</button>
            <h1>Perfil</h1>
            <button class='done align-flush' id="executeUpdate" >Guardar</button>
        </nav> -->
        <nav style="border-color: transparent" class="navbar navbar-default navbar-fixed-top">
            <div class="navbar-header">
                <a class="navbar-toggle menu-left back" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <i style="color: #1974C1;" class="fa fa-arrow-left"></i>
                </a>
              <h1 class="text-left title">Pérfil</h1>
              <a class="navbar-brand" id="b-barrioos" href="index.html"><img src="images/barrioos-iso.png" id="logo" width="auto" height="50px" alt="BarrioOS"></a>
            </div>
        </nav>
        <article id="profile" style="background-color:white !important; z-index:0">

        </article>

        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/facebookConnectPlugin.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script src="js/push-menu.js"></script>
        <script type="text/javascript">
            app.initialize();
        </script>
        <script type="text/javascript">

            function getImage() {

                try {

                    navigator.camera.getPicture(
                            function(imageData){
                                readMedia(imageData)
                            },
                            function(error){

                                if(error.toString() != "Selection cancelled."){
                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido ha salido mal, estamos corrigiendo todos los errores lo más pronto posible',
                                            'Hecho',
                                            '',
                                            'popupRegister');
                                }


                                return false;

                            },
                            {
                                quality: 80,
                                allowEdit : true,
                                destinationType: Camera.DestinationType.FILE_URI,
                                sourceType:Camera.PictureSourceType.SAVEDPHOTOALBUM,
                                encodingType: Camera.EncodingType.JPEG,
                                targetWidth: 150,
                                targetHeight: 150,
                                mediaType:2
                            }
                    );
                }catch(err){
                    showPopup('Lo sentimos :(' ,
                            'Algo ha salido ha salido mal, estamos corrigiendo todos los errores lo más pronto posible',
                            'Hecho',
                            '',
                            'popupRegister');
                }
            }

            var login = function () {
                if (!window.cordova) {
                    //var appId = prompt("Enter FB Application ID", "");
                    facebookConnectPlugin.browserInit("1017010178318950");
                }
                facebookConnectPlugin.login( ["email","public_profile"],
                        function (response) {

                            //alert(JSON.stringify(response));
                            apiTest();

                        },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var showDialog = function () {
                facebookConnectPlugin.showDialog( { method: "feed" },
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var apiTest = function () {
                facebookConnectPlugin.api( "me/?fields=id,email,first_name,last_name", [],
                        function (response) {

                            var user = {}
                            user.provider_id = response.id;
                            user.email = response.email;
                            user.avatar_standar= "http://graph.facebook.com/"+response.id+"/picture?type=large";
                            user.avatar_thumbnail= "http://graph.facebook.com/"+response.id+"/picture?type=small";
                            user.first_name = response.first_name;
                            user.last_name = response.last_name;

                            $.ajax({
                                url: "http://www.proyectodes.net/api/auth/provider",
                                type: "POST",
                                data: user,
                                beforeSend: function(){
                                    $.UIPopup({empty: true});
                                    $('.popup .panel').UIBusy({'color':'#1f344a', 'size': 80});
                                    $('.popup').find('.busy').UICenter('relative');
                                },
                                success: function(response){
                                    $('.popup').UIPopupClose();
                                    window.localStorage.setItem("user", JSON.stringify(response));
                                    goToDashboard();
                                },
                                error: function(e){

                                    $('.popup').UIPopupClose();
                                    alert(JSON.stringify(e.responseJSON));

                                    showPopup('Lo sentimos :(' ,
                                            'Algo ha salido mal intenta iniciar nuevamente',
                                            'Hecho',
                                            '',
                                            'popupRegister');
                                }
                            });

                        },
                        function (response) {
                            showPopup('Lo sentimos :(' ,
                                    'Algo ha salido mal intenta iniciar nuevamente',
                                    'Hecho',
                                    '',
                                    'popupRegister');
                            alert(JSON.stringify(response))
                        });
            }

            var getAccessToken = function () {
                facebookConnectPlugin.getAccessToken(
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var getStatus = function () {
                facebookConnectPlugin.getLoginStatus(
                        function (response) { alert(JSON.stringify(response)) },
                        function (response) { alert(JSON.stringify(response)) });
            }

            var logout = function () {
                facebookConnectPlugin.logout(
                        function (response) {
                            alert(JSON.stringify(response))
                        },
                        function (response) {
                            alert(JSON.stringify(response))
                        });
            }

            function readMedia(archivo){

                var imagenURL=archivo;

                window.resolveLocalFileSystemURL = window.resolveLocalFileSystemURL || window.webkitResolveLocalFileSystemURL;
                window.resolveLocalFileSystemURL(imagenURL, function(fileEntry) {
                    fileEntry.file(function(file){
                        var reader = new FileReader();
                        reader.onloadend = function(evt) {

                            IMAGE_DATA=evt.target.result;
                            $("#avatarContainer").html("<img src='" + IMAGE_DATA + "' height='150' width='150' />");


                        };
                        reader.readAsDataURL(file);
                    }, function(e){

                    })
                });

                return false;
            }

        </script>
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/responsive.css">
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <link rel="stylesheet" href="css/menu.css">

    </body>
</html>
